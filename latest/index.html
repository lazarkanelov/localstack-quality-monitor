<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LocalStack Quality Monitor - 2026-01-11</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-hcl.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        slate: {
                            850: '#172033',
                            950: '#0d1321'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; border-radius: 4px; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }

        .status-passed { background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); }
        .status-partial { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
        .status-failed { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
        .status-timeout { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); }
        .status-error { background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%); }

        .gradient-text {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        details summary::-webkit-details-marker { display: none; }
        details summary { list-style: none; }
        details[open] .chevron { transform: rotate(180deg); }
        .chevron { transition: transform 0.2s ease-in-out; }

        pre[class*="language-"] {
            margin: 0 !important;
            border-radius: 0.5rem !important;
            max-height: 400px;
            overflow: auto;
        }

        code[class*="language-"] {
            font-size: 0.8rem !important;
        }

        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .tab-btn.active {
            border-bottom: 2px solid #3b82f6;
            color: #3b82f6;
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 5px rgba(34, 197, 94, 0.5); }
            50% { box-shadow: 0 0 20px rgba(34, 197, 94, 0.8); }
        }
        .pulse-success { animation: pulse-glow 2s infinite; }
    </style>
</head>
<body class="bg-slate-950 text-gray-100 min-h-screen">
    

    <!-- Header -->
    <header class="bg-slate-900 border-b border-slate-800 sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-2xl font-bold gradient-text">LocalStack Quality Monitor</h1>
                    <p class="text-sm text-slate-400 mt-1">
                        Run <code class="bg-slate-800 px-2 py-0.5 rounded text-xs">e6686639-25e</code>
                        &bull; 2026-01-11
                        &bull; LocalStack <span class="text-blue-400">latest</span>
                        &bull; Duration <span class="text-green-400">0s</span>
                    </p>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-xs text-slate-500">v1.0.0</span>
                    <button onclick="window.print()" class="px-3 py-1 bg-slate-800 hover:bg-slate-700 rounded text-sm transition">
                        Export
                    </button>
                </div>
            </div>

            <!-- Navigation Tabs -->
            <nav class="flex space-x-6 mt-4 -mb-px">
                <button class="tab-btn active px-1 py-2 text-sm font-medium" onclick="showTab('overview')">Overview</button>
                <button class="tab-btn px-1 py-2 text-sm font-medium text-slate-400 hover:text-white" onclick="showTab('results')">Test Results</button>
                <button class="tab-btn px-1 py-2 text-sm font-medium text-slate-400 hover:text-white" onclick="showTab('services')">Service Coverage</button>
                <button class="tab-btn px-1 py-2 text-sm font-medium text-slate-400 hover:text-white" onclick="showTab('history')">Run History</button>
            </nav>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8 max-w-7xl">

        <!-- Overview Tab -->
        <div id="overview" class="tab-content active">
            <!-- Key Metrics -->
            <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-8">
                <div class="bg-slate-900 rounded-xl p-6 border border-slate-800 text-center">
                    <div class="text-4xl font-bold text-white">2</div>
                    <div class="text-sm text-slate-400 mt-1">Architectures Tested</div>
                </div>
                <div class="bg-slate-900 rounded-xl p-6 border border-green-900/50 text-center ">
                    <div class="text-4xl font-bold text-green-400">1</div>
                    <div class="text-sm text-slate-400 mt-1">Fully Compatible</div>
                </div>
                <div class="bg-slate-900 rounded-xl p-6 border border-yellow-900/50 text-center">
                    <div class="text-4xl font-bold text-yellow-400">0</div>
                    <div class="text-sm text-slate-400 mt-1">Partial Issues</div>
                </div>
                <div class="bg-slate-900 rounded-xl p-6 border border-red-900/50 text-center">
                    <div class="text-4xl font-bold text-red-400">1</div>
                    <div class="text-sm text-slate-400 mt-1">Blocked</div>
                </div>
                <div class="bg-slate-900 rounded-xl p-6 border border-blue-900/50 text-center">
                    <div class="text-4xl font-bold text-blue-400">50%</div>
                    <div class="text-sm text-slate-400 mt-1">Pass Rate</div>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="grid md:grid-cols-2 gap-6 mb-8">
                <div class="bg-slate-900 rounded-xl p-6 border border-slate-800">
                    <h2 class="text-lg font-semibold mb-4 text-white">Pass Rate Trend</h2>
                    <div style="height: 200px; position: relative;">
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>
                <div class="bg-slate-900 rounded-xl p-6 border border-slate-800">
                    <h2 class="text-lg font-semibold mb-4 text-white">Test Summary</h2>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center p-3 bg-slate-800/50 rounded-lg">
                            <span class="text-slate-300">Total Tests Run</span>
                            <span class="text-xl font-bold text-white">0</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-green-900/20 rounded-lg border border-green-800/30">
                            <span class="text-green-300">Tests Passed</span>
                            <span class="text-xl font-bold text-green-400">0</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-red-900/20 rounded-lg border border-red-800/30">
                            <span class="text-red-300">Tests Failed</span>
                            <span class="text-xl font-bold text-red-400">0</span>
                        </div>
                        <div class="pt-2 border-t border-slate-700">
                            <div class="flex items-center justify-between">
                                <span class="text-slate-400">Test Pass Rate</span>
                                <span class="text-lg font-semibold text-red-400">
                                    0.0%
                                </span>
                            </div>
                            <div class="mt-2 h-2 bg-slate-700 rounded-full overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-green-500 to-green-400 rounded-full transition-all duration-500"
                                     style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Results Preview -->
            <div class="bg-slate-900 rounded-xl border border-slate-800 overflow-hidden">
                <div class="p-4 border-b border-slate-800 flex justify-between items-center">
                    <h2 class="text-lg font-semibold text-white">Recent Results</h2>
                    <button onclick="showTab('results')" class="text-sm text-blue-400 hover:text-blue-300">View All &rarr;</button>
                </div>
                <div class="divide-y divide-slate-800">
                    
                    <div class="p-4 hover:bg-slate-800/50 transition">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <span class="w-3 h-3 rounded-full status-failed"></span>
                                <div>
                                    <div class="font-medium text-white">ViktorUJ/vpc</div>
                                    <div class="text-xs text-slate-500">5f63fc2a9579</div>
                                </div>
                            </div>
                            <div class="flex items-center space-x-4">
                                <div class="flex space-x-1">
                                    
                                    <span class="px-2 py-0.5 text-xs bg-slate-700 text-slate-300 rounded">ec2</span>
                                    
                                </div>
                                <span class="px-2 py-1 text-xs font-semibold text-white rounded status-failed">
                                    FAILED
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-4 hover:bg-slate-800/50 transition">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <span class="w-3 h-3 rounded-full status-passed"></span>
                                <div>
                                    <div class="font-medium text-white">Simple S3 Test</div>
                                    <div class="text-xs text-slate-500">simple_s3_te</div>
                                </div>
                            </div>
                            <div class="flex items-center space-x-4">
                                <div class="flex space-x-1">
                                    
                                    <span class="px-2 py-0.5 text-xs bg-slate-700 text-slate-300 rounded">s3</span>
                                    
                                </div>
                                <span class="px-2 py-1 text-xs font-semibold text-white rounded status-passed">
                                    PASSED
                                </span>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>

        <!-- Test Results Tab -->
        <div id="results" class="tab-content">
            <!-- Filter Buttons -->
            <div class="flex space-x-2 mb-6">
                <button onclick="filterResults('all')" class="filter-btn active px-4 py-2 bg-slate-800 hover:bg-slate-700 rounded-lg text-sm transition">
                    All (2)
                </button>
                <button onclick="filterResults('passed')" class="filter-btn px-4 py-2 bg-green-900/30 hover:bg-green-900/50 text-green-400 rounded-lg text-sm transition">
                    Passed (1)
                </button>
                <button onclick="filterResults('partial')" class="filter-btn px-4 py-2 bg-yellow-900/30 hover:bg-yellow-900/50 text-yellow-400 rounded-lg text-sm transition">
                    Partial (0)
                </button>
                <button onclick="filterResults('failed')" class="filter-btn px-4 py-2 bg-red-900/30 hover:bg-red-900/50 text-red-400 rounded-lg text-sm transition">
                    Failed (1)
                </button>
            </div>

            <!-- Results Cards -->
            <div class="space-y-4" id="resultsContainer">
                
                <div class="result-card bg-slate-900 rounded-xl border border-slate-800 overflow-hidden" data-status="failed">
                    <!-- Result Header -->
                    <div class="p-4 border-b border-slate-800">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <div class="flex items-center space-x-3">
                                    <span class="px-3 py-1 text-xs font-bold text-white rounded-full status-failed">
                                        FAILED
                                    </span>
                                    <h3 class="text-lg font-semibold text-white">ViktorUJ/vpc</h3>
                                </div>
                                <div class="mt-2 flex items-center space-x-4 text-sm text-slate-400">
                                    <span title="Architecture Hash">
                                        <svg class="inline w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14"/>
                                        </svg>
                                        5f63fc2a95796608
                                    </span>
                                    <span title="Duration">
                                        <svg class="inline w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        </svg>
                                        311.9s
                                    </span>
                                    
                                    <a href="https://registry.terraform.io/modules/ViktorUJ/vpc/aws/1.1.0" target="_blank" class="text-blue-400 hover:text-blue-300">
                                        <svg class="inline w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                                        </svg>
                                        Source
                                    </a>
                                    
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-sm">
                                    <span class="text-green-400 font-semibold">0</span>
                                    <span class="text-slate-500">/</span>
                                    <span class="text-red-400 font-semibold">0</span>
                                    <span class="text-slate-500 ml-1">tests</span>
                                </div>
                            </div>
                        </div>

                        <!-- Services Tags -->
                        <div class="mt-3 flex flex-wrap gap-2">
                            
                            <span class="px-2 py-1 text-xs bg-blue-900/30 text-blue-300 rounded border border-blue-800/50">
                                ec2
                            </span>
                            
                        </div>
                    </div>

                    <!-- Failure Analysis (prominently displayed for failed architectures) -->
                    
                    <div class="p-4 border-t border-slate-800
                        bg-yellow-900/20 border-l-4 border-l-yellow-500
                        ">

                        <div class="flex items-start space-x-3">
                            <div class="flex-shrink-0">
                                
                                <svg class="w-6 h-6 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center space-x-2 mb-2">
                                    <h4 class="text-sm font-bold
                                        text-yellow-400">
                                        Terraform Apply Failed
                                    </h4>
                                    <span class="px-2 py-0.5 text-xs font-semibold rounded-full uppercase
                                        bg-yellow-500/20 text-yellow-300
                                        ">
                                        medium
                                    </span>
                                    
                                </div>

                                <div class="space-y-3 text-sm">
                                    <!-- Root Cause -->
                                    <div>
                                        <span class="text-slate-400 font-medium">Root Cause:</span>
                                        <p class="text-slate-300 mt-1">Terraform failed to apply the configuration.</p>
                                    </div>

                                    <!-- LocalStack Impact -->
                                    <div>
                                        <span class="font-medium
                                            text-yellow-400">LocalStack Quality Impact:</span>
                                        <p class="text-slate-300 mt-1">Unable to determine specific LocalStack impact without more details.</p>
                                    </div>

                                    

                                    

                                    
                                </div>
                            </div>
                        </div>
                    </div>
                    

                    <!-- Expandable Details -->
                    <details class="group">
                        <summary class="px-4 py-3 bg-slate-800/50 hover:bg-slate-800 cursor-pointer flex items-center justify-between transition">
                            <span class="text-sm font-medium text-slate-300">View Details</span>
                            <svg class="chevron w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                            </svg>
                        </summary>

                        <div class="p-4 space-y-6">
                            <!-- Source Information -->
                            
                            <div>
                                <h4 class="text-sm font-semibold text-slate-300 mb-2 flex items-center">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/>
                                    </svg>
                                    Source Information
                                </h4>
                                <div class="bg-slate-800 rounded-lg p-4">
                                    <dl class="grid grid-cols-2 gap-4 text-sm">
                                        <div>
                                            <dt class="text-slate-500">Source Type</dt>
                                            <dd class="text-white">terraform_registry</dd>
                                        </div>
                                        <div>
                                            <dt class="text-slate-500">Original Format</dt>
                                            <dd class="text-white">terraform</dd>
                                        </div>
                                        <div class="col-span-2">
                                            <dt class="text-slate-500">Source URL</dt>
                                            <dd><a href="https://registry.terraform.io/modules/ViktorUJ/vpc/aws/1.1.0" target="_blank" class="text-blue-400 hover:underline break-all">https://registry.terraform.io/modules/ViktorUJ/vpc/aws/1.1.0</a></dd>
                                        </div>
                                    </dl>
                                </div>
                            </div>
                            

                            <!-- Terraform Files -->
                            
                            <div>
                                <h4 class="text-sm font-semibold text-slate-300 mb-2 flex items-center justify-between">
                                    <span class="flex items-center">
                                        <svg class="w-4 h-4 mr-2 text-purple-400" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M1 0l4.2 2.4v4.8L1 4.8zm6.6 3.8l4.2 2.4v4.8l-4.2-2.4zm-6.6 7l4.2 2.4v4.8L1 15.6zm6.6 3.8l4.2 2.4v4.8l-4.2-2.4zm6.6-12l4.2 2.4v4.8l-4.2-2.4zm0 10.8l4.2 2.4v4.8l-4.2-2.4z"/>
                                        </svg>
                                        Terraform Infrastructure
                                    </span>
                                    
                                    <a href="https://github.com/lazarkanelov/ls-arch-artifacts /tree/main/architectures/5f63fc2a95796608" target="_blank" class="text-xs text-purple-400 hover:text-purple-300 flex items-center">
                                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                                        </svg>
                                        View in Artifact Repo
                                    </a>
                                    
                                </h4>
                                <div class="space-y-3">
                                    
                                    <details class="bg-slate-800 rounded-lg overflow-hidden">
                                        <summary class="px-3 py-2 bg-slate-700 text-xs text-slate-300 font-mono flex items-center cursor-pointer hover:bg-slate-600 transition">
                                            <svg class="w-4 h-4 mr-2 text-purple-400" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M1 0l4.2 2.4v4.8L1 4.8zm6.6 3.8l4.2 2.4v4.8l-4.2-2.4z"/>
                                            </svg>
                                            main.tf
                                            <svg class="ml-auto chevron w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                            </svg>
                                        </summary>
                                        <pre class="!bg-slate-900"><code class="language-hcl"></code></pre>
                                    </details>
                                    
                                    <details class="bg-slate-800 rounded-lg overflow-hidden">
                                        <summary class="px-3 py-2 bg-slate-700 text-xs text-slate-300 font-mono flex items-center cursor-pointer hover:bg-slate-600 transition">
                                            <svg class="w-4 h-4 mr-2 text-purple-400" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M1 0l4.2 2.4v4.8L1 4.8zm6.6 3.8l4.2 2.4v4.8l-4.2-2.4z"/>
                                            </svg>
                                            variables.tf
                                            <svg class="ml-auto chevron w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                            </svg>
                                        </summary>
                                        <pre class="!bg-slate-900"><code class="language-hcl">variable "vpc" {
  type = object({
    name                  = string
    cidr                  = string
    secondary_cidr_blocks = optional(list(string), [])
    tags                  = optional(map(string), {})
    instance_tenancy      = optional(string, "default") # default, dedicated
    enable_dns_support    = optional(bool, true)        # true, false
    enable_dns_hostnames  = optional(bool, true)        # true, false
    nacl_default = optional(map(object({
      egress      = string # true, false
      rule_number = string # ACL entries are processed in ascending order by rule number
      rule_action = string # allow | deny
      from_port   = optional(string, "")
      to_port     = optional(string, "")
      icmp_code   = optional(string, "")
      # (Optional) ICMP protocol: The ICMP type. Required if specifying ICMP for the protocolE.g., -1
      icmp_type = optional(string, "")
      # (Optional) ICMP protocol: The ICMP code. Required if specifying ICMP for the protocolE.g., -1
      protocol   = string # A value of -1 means all protocols , tcp  - 6 ,
      cidr_block = optional(string, "")
      # The network range to allow or deny, in CIDR notation (for example 172.16.0.0/24 ).
      ipv6_cidr_block = optional(string, "")

    })), {})
    dhcp_options = optional(object({
      domain_name                       = optional(string, "")
      domain_name_servers               = optional(list(string), [])
      ntp_servers                       = optional(list(string), [])
      netbios_name_servers              = optional(list(string), [])
      netbios_node_type                 = optional(string, "")    # 1, 2, 4, 8  . default 2 . http://www.ietf.org/rfc/rfc2132.txt
      ipv6_address_preferred_lease_time = optional(string, "140") # 140 .. 2147483647 seconds . default 140
      tags                              = optional(map(string), {})
    }), {})
  })

  # Validation for CIDR format
  validation {
    condition     = can(cidrsubnet(var.vpc.cidr, 0, 0))
    error_message = "Invalid CIDR block format for VPC. CIDR block must be a valid subnet, e.g., 10.0.0.0/16."
  }

  # Validation for netbios_node_type field
  validation {
    condition = var.vpc.dhcp_options.netbios_node_type == "" || contains([
      "1", "2", "4", "8"
    ], var.vpc.dhcp_options.netbios_node_type)
    error_message = "Invalid value for netbios_node_type. Must be one of: 1, 2, 4, 8."
  }

  # Validation for ipv6_address_preferred_lease_time
  validation {
    condition = (
      var.vpc.dhcp_options.ipv6_address_preferred_lease_time == "" ||
      (
        length(var.vpc.dhcp_options.ipv6_address_preferred_lease_time) > 0 &&
        can(tonumber(var.vpc.dhcp_options.ipv6_address_preferred_lease_time)) &&
        tonumber(var.vpc.dhcp_options.ipv6_address_preferred_lease_time) >= 140 &&
        tonumber(var.vpc.dhcp_options.ipv6_address_preferred_lease_time) <= 2147483647
      )
    )
    error_message = "Invalid value for ipv6_address_preferred_lease_time. Must be a number between 140 and 2147483647 seconds."
  }
}

variable "tags_default" {
  type    = map(string)
  default = {}
}


variable "subnets" {
  type = object({
    public = optional(map(object({
      name = string
      cidr = string
      az   = string # Availability Zone or Availability Zone ID
      tags = optional(map(string), {})
      type = optional(string, "public") # any sort key for grouping . example , DB , WEB , APP , etc

      assign_ipv6_address_on_creation                = optional(bool, false)
      customer_owned_ipv4_pool                       = optional(string, "")
      enable_dns64                                   = optional(bool, false)
      enable_resource_name_dns_aaaa_record_on_launch = optional(bool, false)
      enable_resource_name_dns_a_record_on_launch    = optional(bool, true)
      ipv6_cidr_block                                = optional(string, "")
      ipv6_native                                    = optional(bool, false)
      map_customer_owned_ip_on_launch                = optional(bool, false)
      map_public_ip_on_launch                        = optional(bool, true)
      outpost_arn                                    = optional(string, "")
      private_dns_hostname_type_on_launch            = optional(string, "ip-name") #  The type of hostnames to assign to instances in the subnet at launch. For IPv6-only subnets, an instance DNS name must be based on the instance ID. For dual-stack and IPv4-only subnets, you can specify whether DNS names use the instance IPv4 address or the instance ID . Valid values:  ip-name, resource-name.
      nat_gateway                                    = optional(string, "")        #  DEFAULT - default nat gateway for all AZ  with SINGLE value
      nacl = optional(map(object({
        egress          = string # true, false
        rule_number     = string # ACL entries are processed in ascending order by rule number
        rule_action     = string # allow | deny
        from_port       = optional(string, "")
        to_port         = optional(string, "")
        icmp_code       = optional(string, "") # (Optional) ICMP protocol: The ICMP type. Required if specifying ICMP for the protocolE.g., -1
        icmp_type       = optional(string, "") # (Optional) ICMP protocol: The ICMP code. Required if specifying ICMP for the protocolE.g., -1
        protocol        = string               # A value of -1 means all protocols , tcp  - 6 ,
        cidr_block      = optional(string, "") # The network range to allow or deny, in CIDR notation (for example 172.16.0.0/24 ).
        ipv6_cidr_block = optional(string, "")

      })), {})

    })))
    private = optional(map(object({
      name                                           = string
      cidr                                           = string
      az                                             = string # Availability Zone or Availability Zone ID
      tags                                           = optional(map(string), {})
      type                                           = optional(string, "private") # any sort key for grouping . example , DB , WEB , APP , etc
      nat_gateway                                    = optional(string, "AZ")      # AZ - nat gateway for  each AZ , SINGLE - single nat gateway for all AZ (for this option you need to set nat_gateway=DEFAULT in one of the public networks)  ,SUBNET - dedicate nat gateway for each  subnet with SUBNET  type   ,  NONE - no nat gateway
      assign_ipv6_address_on_creation                = optional(bool, false)
      customer_owned_ipv4_pool                       = optional(string, "")
      enable_dns64                                   = optional(bool, false)
      enable_resource_name_dns_aaaa_record_on_launch = optional(bool, false)
      enable_resource_name_dns_a_record_on_launch    = optional(bool, false)
      ipv6_cidr_block                                = optional(string, "")
      ipv6_native                                    = optional(bool, false)
      map_customer_owned_ip_on_launch                = optional(bool, false)
      map_public_ip_on_launch                        = optional(bool, true)
      outpost_arn                                    = optional(string, "")
      private_dns_hostname_type_on_launch            = optional(string, "ip-name") #  The type of hostnames to assign to instances in the subnet at launch. For IPv6-only subnets, an instance DNS name must be based on the instance ID. For dual-stack and IPv4-only subnets, you can specify whether DNS names use the instance IPv4 address or the instance ID . Valid values:  ip-name, resource-name.
      nacl = optional(map(object({
        egress          = string # true, false
        rule_number     = string # ACL entries are processed in ascending order by rule number
        rule_action     = string # allow | deny
        from_port       = optional(string, "")
        to_port         = optional(string, "")
        icmp_code       = optional(string, "") # (Optional) ICMP protocol: The ICMP type. Required if specifying ICMP for the protocolE.g., -1
        icmp_type       = optional(string, "") # (Optional) ICMP protocol: The ICMP code. Required if specifying ICMP for the protocolE.g., -1
        protocol        = string               # A value of -1 means all protocols , tcp  - 6 ,
        cidr_block      = optional(string, "") # The network range to allow or deny, in CIDR notation (for example 172.16.0.0/24 ).
        ipv6_cidr_block = optional(string, "")

      })), {})

    })))
  })
  default = {
    public  = {}
    private = {}
  }

  validation {
    condition = alltrue([
      for _, subnet in coalesce(var.subnets.private, {}) : contains(["AZ", "SINGLE", "DEFAULT", "SUBNET", "NONE"], subnet.nat_gateway)
    ])
    error_message = "nat_gateway must be one of: AZ, SINGLE, DEFAULT, SUBNET, NONE."
  }

  validation {
    condition = alltrue([
      for _, subnet in coalesce(var.subnets.private, {}) : can(cidrsubnet(subnet.cidr, 0, 0))
    ])
    error_message = "Invalid CIDR block format. CIDR block must be a valid subnet, e.g., 10.10.16.0/24."
  }

  validation {
    condition = alltrue([
      for _, subnet in coalesce(var.subnets.private, {}) : contains(["ip-name", "resource-name"], subnet.private_dns_hostname_type_on_launch)
    ])
    error_message = "Invalid value for private_dns_hostname_type_on_launch. Must be one of: ip-name, resource-name."
  }

  validation {
    condition = alltrue([
      for _, subnet in coalesce(var.subnets.public, {}) : can(cidrsubnet(subnet.cidr, 0, 0))
    ])
    error_message = "Invalid CIDR block format. CIDR block must be a valid subnet, e.g., 10.10.16.0/24."
  }

  validation {
    condition = alltrue([
      for _, subnet in coalesce(var.subnets.public, {}) : contains(["ip-name", "resource-name"], subnet.private_dns_hostname_type_on_launch)
    ])
    error_message = "Invalid value for private_dns_hostname_type_on_launch. Must be one of: ip-name, resource-name."
  }
}

variable "existing_eip_ids_az" {
  description = "A map of existing Elastic IPs IDs to associate with the NAT Gateways where key is the AZ, value is the EIP ID"
  type        = map(string)
  default     = {}

  validation {
    condition = alltrue([
      for az, eip in var.existing_eip_ids_az : can(regex("^eipalloc-[0-9a-fA-F]{17}$", eip))
    ])
    error_message = "Each value in existing_eip_ids_az must be a valid Elastic IP ID (eipalloc-xxxxxxxxxxxxxxxxx)."
  }

  validation {
    condition = alltrue([
      for az, eip in var.existing_eip_ids_az : can(regex("^[a-z]{2}-[a-z]+-[0-9]{1}[a-z]$", az))
    ])
    error_message = "Each key in existing_eip_ids_az must be a valid Availability Zone (e.g., eu-west-1a)."
  }
}
</code></pre>
                                    </details>
                                    
                                    <details class="bg-slate-800 rounded-lg overflow-hidden">
                                        <summary class="px-3 py-2 bg-slate-700 text-xs text-slate-300 font-mono flex items-center cursor-pointer hover:bg-slate-600 transition">
                                            <svg class="w-4 h-4 mr-2 text-purple-400" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M1 0l4.2 2.4v4.8L1 4.8zm6.6 3.8l4.2 2.4v4.8l-4.2-2.4z"/>
                                            </svg>
                                            locals.tf
                                            <svg class="ml-auto chevron w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                            </svg>
                                        </summary>
                                        <pre class="!bg-slate-900"><code class="language-hcl">locals {
  az_mapping = {
    for idx, az in data.aws_availability_zones.available.names : az =>
    data.aws_availability_zones.available.zone_ids[idx]
  }

  az_id_to_az = { for az, az_id in local.az_mapping : az_id => az }

  normalized_public_subnets_all = {
    for k, v in var.subnets.public : k => merge(v, {
      az = lookup(local.az_id_to_az, v.az, v.az) # modify AZ ID to AZ
    })
  }

  normalized_private_subnets_all = {
    for k, v in var.subnets.private : k => merge(v, {
      az = lookup(local.az_id_to_az, v.az, v.az) # modify AZ ID to AZ
    })
  }

  # group by type and create a list of identifiers
  private_subnets_by_type = {
    for type in distinct([for k, v in local.normalized_private_subnets_all : v.type]) : type => {
      ids  = [for k, v in local.normalized_private_subnets_all : aws_subnet.private[k].id if v.type == type]
      keys = [for k, v in local.normalized_private_subnets_all : k if v.type == type]
    }
  }

  public_subnets_by_type = {
    for type in distinct([for k, v in var.subnets.public : v.type]) : type => {
      ids  = [for k, v in local.normalized_public_subnets_all : aws_subnet.public[k].id if v.type == type]
      keys = [for k, v in local.normalized_public_subnets_all : k if v.type == type]
    }
  }

  private_subnets_by_az_output = {
    for az in distinct([for subnet in local.normalized_private_subnets_all : subnet.az]) : az => [
      for subnet_key, subnet in local.normalized_private_subnets_all : aws_subnet.private[subnet_key].id
      if subnet.az == az
    ]
  }

  public_subnets_by_az_output = {
    for az in distinct([for subnet in local.normalized_public_subnets_all : subnet.az]) : az => [
      for subnet_key, subnet in local.normalized_public_subnets_all : aws_subnet.public[subnet_key].id
      if subnet.az == az
    ]
  }


  private_subnets_by_az_id = {
    for az_id in distinct([for subnet in local.normalized_private_subnets_all : lookup(local.az_mapping, subnet.az)]) : az_id => [
      for subnet_key, subnet in local.normalized_private_subnets_all : aws_subnet.private[subnet_key].id
      if lookup(local.az_mapping, subnet.az) == az_id
    ]
  }

  public_subnets_by_az_id = {
    for az_id in distinct([for subnet in local.normalized_public_subnets_all : lookup(local.az_mapping, subnet.az)]) : az_id => [
      for subnet_key, subnet in local.normalized_public_subnets_all : aws_subnet.public[subnet_key].id
      if lookup(local.az_mapping, subnet.az) == az_id
    ]
  }
}
</code></pre>
                                    </details>
                                    
                                    <details class="bg-slate-800 rounded-lg overflow-hidden">
                                        <summary class="px-3 py-2 bg-slate-700 text-xs text-slate-300 font-mono flex items-center cursor-pointer hover:bg-slate-600 transition">
                                            <svg class="w-4 h-4 mr-2 text-purple-400" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M1 0l4.2 2.4v4.8L1 4.8zm6.6 3.8l4.2 2.4v4.8l-4.2-2.4z"/>
                                            </svg>
                                            versions.tf
                                            <svg class="ml-auto chevron w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                            </svg>
                                        </summary>
                                        <pre class="!bg-slate-900"><code class="language-hcl">terraform {
  required_version = ">= 1.0"

  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = ">= 5.46"
    }
  }
}
</code></pre>
                                    </details>
                                    
                                    <details class="bg-slate-800 rounded-lg overflow-hidden">
                                        <summary class="px-3 py-2 bg-slate-700 text-xs text-slate-300 font-mono flex items-center cursor-pointer hover:bg-slate-600 transition">
                                            <svg class="w-4 h-4 mr-2 text-purple-400" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M1 0l4.2 2.4v4.8L1 4.8zm6.6 3.8l4.2 2.4v4.8l-4.2-2.4z"/>
                                            </svg>
                                            vpc.tf
                                            <svg class="ml-auto chevron w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                            </svg>
                                        </summary>
                                        <pre class="!bg-slate-900"><code class="language-hcl">resource "aws_vpc" "default" {
  cidr_block           = var.vpc.cidr
  enable_dns_support   = var.vpc.enable_dns_support
  enable_dns_hostnames = var.vpc.enable_dns_hostnames
  tags                 = merge(var.tags_default, { "Name" = var.vpc.name }, var.vpc.tags)
}

resource "aws_internet_gateway" "default" {
  vpc_id = aws_vpc.default.id
  tags   = merge(var.tags_default, { "Name" = var.vpc.name }, var.vpc.tags)
}

resource "aws_vpc_ipv4_cidr_block_association" "default" {
  for_each   = toset(var.vpc.secondary_cidr_blocks)
  vpc_id     = aws_vpc.default.id
  cidr_block = each.value
}

resource "aws_network_acl_rule" "default" {
  for_each        = var.vpc.nacl_default
  network_acl_id  = aws_vpc.default.default_network_acl_id
  rule_number     = each.value.rule_number
  egress          = each.value.egress
  protocol        = each.value.protocol
  rule_action     = each.value.rule_action
  cidr_block      = each.value.cidr_block != "" ? each.value.cidr_block : null
  from_port       = each.value.from_port != "" ? each.value.from_port : null
  to_port         = each.value.to_port != "" ? each.value.to_port : null
  ipv6_cidr_block = each.value.ipv6_cidr_block != "" ? each.value.ipv6_cidr_block : null
}


locals {
  # Check if any DHCP option is defined (for strings and lists)
  dhcp_options_defined = (
    var.vpc.dhcp_options.domain_name != "" ||
    length(var.vpc.dhcp_options.domain_name_servers) > 0 ||
    length(var.vpc.dhcp_options.ntp_servers) > 0 ||
    length(var.vpc.dhcp_options.netbios_name_servers) > 0 ||
    var.vpc.dhcp_options.netbios_node_type != "" ||
    var.vpc.dhcp_options.ipv6_address_preferred_lease_time != "140"
  )
}

resource "aws_vpc_dhcp_options" "default" {
  for_each                          = local.dhcp_options_defined ? toset(["enable"]) : toset([])
  domain_name                       = var.vpc.dhcp_options.domain_name != "" ? var.vpc.dhcp_options.domain_name : null
  domain_name_servers               = length(var.vpc.dhcp_options.domain_name_servers) > 0 ? var.vpc.dhcp_options.domain_name_servers : null
  ntp_servers                       = length(var.vpc.dhcp_options.ntp_servers) > 0 ? var.vpc.dhcp_options.ntp_servers : null
  netbios_name_servers              = length(var.vpc.dhcp_options.netbios_name_servers) > 0 ? var.vpc.dhcp_options.netbios_name_servers : null
  netbios_node_type                 = var.vpc.dhcp_options.netbios_node_type != "" ? var.vpc.dhcp_options.netbios_node_type : null
  ipv6_address_preferred_lease_time = var.vpc.dhcp_options.ipv6_address_preferred_lease_time != "140" ? var.vpc.dhcp_options.ipv6_address_preferred_lease_time : null
  tags                              = merge(var.tags_default, { "Name" = var.vpc.name }, var.vpc.tags)
}

resource "aws_vpc_dhcp_options_association" "default" {
  for_each        = local.dhcp_options_defined ? toset(["enable"]) : toset([])
  vpc_id          = aws_vpc.default.id
  dhcp_options_id = aws_vpc_dhcp_options.default[each.key].id
}
</code></pre>
                                    </details>
                                    
                                    <details class="bg-slate-800 rounded-lg overflow-hidden">
                                        <summary class="px-3 py-2 bg-slate-700 text-xs text-slate-300 font-mono flex items-center cursor-pointer hover:bg-slate-600 transition">
                                            <svg class="w-4 h-4 mr-2 text-purple-400" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M1 0l4.2 2.4v4.8L1 4.8zm6.6 3.8l4.2 2.4v4.8l-4.2-2.4z"/>
                                            </svg>
                                            subnets_private.tf
                                            <svg class="ml-auto chevron w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                            </svg>
                                        </summary>
                                        <pre class="!bg-slate-900"><code class="language-hcl">resource "aws_subnet" "private" {
  vpc_id                  = aws_vpc.default.id
  for_each                = local.normalized_private_subnets_all
  map_public_ip_on_launch = "false"
  cidr_block              = each.value.cidr

  assign_ipv6_address_on_creation                = each.value.assign_ipv6_address_on_creation
  customer_owned_ipv4_pool                       = each.value.customer_owned_ipv4_pool != "" ? each.value.customer_owned_ipv4_pool : null
  enable_dns64                                   = each.value.enable_dns64
  enable_resource_name_dns_aaaa_record_on_launch = each.value.enable_resource_name_dns_aaaa_record_on_launch
  enable_resource_name_dns_a_record_on_launch    = each.value.enable_resource_name_dns_a_record_on_launch
  ipv6_cidr_block                                = each.value.ipv6_cidr_block != "" ? each.value.ipv6_cidr_block : null
  ipv6_native                                    = each.value.ipv6_native
  map_customer_owned_ip_on_launch                = each.value.map_customer_owned_ip_on_launch ? each.value.map_customer_owned_ip_on_launch : null
  outpost_arn                                    = each.value.outpost_arn != "" ? each.value.outpost_arn : null
  private_dns_hostname_type_on_launch            = each.value.private_dns_hostname_type_on_launch != "" ? each.value.private_dns_hostname_type_on_launch : null



  availability_zone = each.value.az

  tags = merge(var.tags_default, { "Name" = each.value.name }, { "type" = each.value.type }, { "subnet_key" = each.key }, { "access_type" = "private" }, each.value.tags)
}




resource "aws_route_table" "private" {
  for_each = local.normalized_private_subnets_all
  vpc_id   = aws_vpc.default.id
  tags     = merge(var.tags_default, { "Name" = each.value.name }, { "type" = each.value.type }, { "subnet_key" = each.key }, { "access_type" = "private" }, each.value.tags)
}

resource "aws_route_table_association" "private" {
  for_each       = local.normalized_private_subnets_all
  route_table_id = aws_route_table.private["${each.key}"].id
  subnet_id      = aws_subnet.private["${each.key}"].id
}

# < Az NAT Gateway
locals {
  normalized_private_subnets_AZ = {
    for k, v in var.subnets.private : k => merge(v, {
      az = lookup(local.az_id_to_az, v.az, v.az) #  AZ ID  AZ,   
    })
    if v.nat_gateway == "AZ" #    ,  nat_gateway = "AZ"
  }



  private_subnets_by_az = {
    for az in distinct([for s in local.normalized_private_subnets_AZ : s.az]) :
    az => {
      ids  = [for k, s in local.normalized_private_subnets_AZ : aws_subnet.private[k].id if s.az == az]
      keys = [for k, s in local.normalized_private_subnets_AZ : k if s.az == az]
    }
  }
}

resource "aws_nat_gateway" "az_nat_gateway" {
  for_each = local.private_subnets_by_az

  allocation_id = length(keys(var.existing_eip_ids_az)) == 0 ? aws_eip.az_nat_gateway_eip[each.key].id : var.existing_eip_ids_az[each.key]
  subnet_id     = local.public_subnets_by_az_output[each.key][0]
  tags          = merge(var.tags_default, { "Name" = "az_nat_gateway-${each.key}" })
}

resource "aws_eip" "az_nat_gateway_eip" {
  for_each = length(keys(var.existing_eip_ids_az)) == 0 ? {
    for az, data in local.private_subnets_by_az : az => az
  } : {}
  domain = "vpc"
  tags   = merge(var.tags_default, { "Name" = "az_nat_gateway-${each.key}" })
}

locals {
  flat_private_subnet_keys = flatten([
    for az, data in local.private_subnets_by_az : [
      for key in data.keys : {
        key = key
        az  = az
        id  = "${az}-${key}"
      }
    ]
  ])

  routes_map_private_subnet_az = {
    for entry in local.flat_private_subnet_keys : entry.id => {
      key = entry.key
      az  = entry.az
    }
  }
}

resource "aws_route" "private_route_az" {

  for_each = local.routes_map_private_subnet_az

  route_table_id         = aws_route_table.private[each.value.key].id
  destination_cidr_block = "0.0.0.0/0"
  nat_gateway_id         = aws_nat_gateway.az_nat_gateway[each.value.az].id
}




# Az NAT Gateway >



# < SUBNET NAT Gateway

locals {
  normalized_private_subnets_SUBNET = {
    for k, v in var.subnets.private : k => merge(v, {
      az = lookup(local.az_id_to_az, v.az, v.az) #  AZ ID  AZ,   
    })
    if v.nat_gateway == "SUBNET" #    ,  nat_gateway = "SUBNET"
  }


}


resource "aws_eip" "SUBNET_nat_gateway_eip" {
  for_each = local.normalized_private_subnets_SUBNET
  tags     = merge(var.tags_default, { "Name" = "SUBNET_nat_gateway-${each.key}" })
  domain   = "vpc"
}

resource "aws_nat_gateway" "SUBNET_nat_gateway" {
  for_each = local.normalized_private_subnets_SUBNET

  allocation_id = aws_eip.SUBNET_nat_gateway_eip[each.key].id
  subnet_id     = local.public_subnets_by_az_output[each.value.az][0]
  tags          = merge(var.tags_default, { "Name" = "SUBNET_nat_gateway-${each.key}" })
}


resource "aws_route" "private_route_SUBNET" {

  for_each               = local.normalized_private_subnets_SUBNET
  route_table_id         = aws_route_table.private[each.key].id
  destination_cidr_block = "0.0.0.0/0"
  nat_gateway_id         = aws_nat_gateway.SUBNET_nat_gateway[each.key].id
}


# SUBNET NAT Gateway >


# < SINGLE NAT Gateway

locals {
  normalized_private_subnets_SINGLE = {
    for k, v in var.subnets.private : k => merge(v, {
      az = lookup(local.az_id_to_az, v.az, v.az) #  AZ ID  AZ,   
    })
    if v.nat_gateway == "SINGLE" #    ,  nat_gateway = "SUBNET"
  }

  normalized_public_subnets_DEFAULT = {
    for k, v in var.subnets.public : k => merge(v, {
      az = lookup(local.az_id_to_az, v.az, v.az) #  AZ ID  AZ,   
    })
    if v.nat_gateway == "DEFAULT" #    ,  nat_gateway = "DEFAULT"
  }
  normalized_public_subnets_DEFAULT_keys             = keys(local.normalized_public_subnets_DEFAULT)
  normalized_public_subnets_DEFAULT_first_subnet_key = length(local.normalized_public_subnets_DEFAULT_keys) > 0 ? local.normalized_public_subnets_DEFAULT_keys[0] : null

  normalized_public_subnets_DEFAULT_selected = {
    for k, v in local.normalized_public_subnets_DEFAULT :
    k => v if k == local.normalized_public_subnets_DEFAULT_first_subnet_key
  }
}


resource "aws_eip" "SINGLE_nat_gateway_eip" {
  for_each = local.normalized_public_subnets_DEFAULT_selected
  tags     = merge(var.tags_default, { "Name" = "SINGLE_nat_gateway-${each.key}" })
  domain   = "vpc"
}



resource "aws_nat_gateway" "SINGLE_nat_gateway" {
  for_each = local.normalized_public_subnets_DEFAULT_selected

  allocation_id = aws_eip.SINGLE_nat_gateway_eip[each.key].id
  subnet_id     = aws_subnet.public[each.key].id
  tags          = merge(var.tags_default, { "Name" = "SINGLE_nat_gateway-${each.key}" })
}


resource "aws_route" "private_route_SINGLE" {

  for_each               = local.normalized_private_subnets_SINGLE
  route_table_id         = aws_route_table.private[each.key].id
  destination_cidr_block = "0.0.0.0/0"
  nat_gateway_id         = aws_nat_gateway.SINGLE_nat_gateway["${local.normalized_public_subnets_DEFAULT_first_subnet_key}"].id
}

#  SINGLE NAT Gateway  >


# NACL

# Local variable to flatten all NACL rules for private subnets
locals {
  private_nacl_rules = flatten([
    for subnet_key, subnet in var.subnets.private : [
      for rule_key, rule in subnet.nacl : {
        subnet_key = subnet_key
        rule_key   = rule_key
        rule       = rule
      }
    ]
  ])
}

# Create a Network ACL for each private subnet if nacl is defined
resource "aws_network_acl" "private" {
  for_each = {
    for subnet_key, subnet in var.subnets.private :
    subnet_key => subnet
    if length(subnet.nacl) > 0
  }

  vpc_id = aws_vpc.default.id

  tags = merge(var.tags_default, {
    "Name" = "${each.value.name}-nacl"
  })
}

# Create Network ACL rules for each private subnet's NACL
resource "aws_network_acl_rule" "private_rules" {
  for_each = {
    for rule in local.private_nacl_rules :
    "${rule.subnet_key}-${rule.rule_key}-${rule.rule.rule_number}" => rule
    if length(var.subnets.private[rule.subnet_key].nacl) > 0
  }

  network_acl_id  = aws_network_acl.private[each.value.subnet_key].id
  rule_number     = each.value.rule.rule_number
  egress          = each.value.rule.egress == "true" ? true : false
  protocol        = each.value.rule.protocol
  rule_action     = each.value.rule.rule_action
  cidr_block      = each.value.rule.cidr_block != "" ? each.value.rule.cidr_block : null
  from_port       = each.value.rule.from_port != "" ? tonumber(each.value.rule.from_port) : null
  to_port         = each.value.rule.to_port != "" ? tonumber(each.value.rule.to_port) : null
  icmp_code       = each.value.rule.icmp_code != "" ? tonumber(each.value.rule.icmp_code) : null
  icmp_type       = each.value.rule.icmp_type != "" ? tonumber(each.value.rule.icmp_type) : null
  ipv6_cidr_block = each.value.rule.ipv6_cidr_block != "" ? each.value.rule.ipv6_cidr_block : null
}

# Associate the NACL with each private subnet if NACL is defined
resource "aws_network_acl_association" "private_association" {
  for_each = {
    for subnet_key, subnet in var.subnets.private :
    subnet_key => subnet
    if length(subnet.nacl) > 0
  }

  subnet_id      = aws_subnet.private[each.key].id
  network_acl_id = aws_network_acl.private[each.key].id
}
</code></pre>
                                    </details>
                                    
                                    <details class="bg-slate-800 rounded-lg overflow-hidden">
                                        <summary class="px-3 py-2 bg-slate-700 text-xs text-slate-300 font-mono flex items-center cursor-pointer hover:bg-slate-600 transition">
                                            <svg class="w-4 h-4 mr-2 text-purple-400" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M1 0l4.2 2.4v4.8L1 4.8zm6.6 3.8l4.2 2.4v4.8l-4.2-2.4z"/>
                                            </svg>
                                            data.tf
                                            <svg class="ml-auto chevron w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                            </svg>
                                        </summary>
                                        <pre class="!bg-slate-900"><code class="language-hcl">data "aws_availability_zones" "available" {}
</code></pre>
                                    </details>
                                    
                                    <details class="bg-slate-800 rounded-lg overflow-hidden">
                                        <summary class="px-3 py-2 bg-slate-700 text-xs text-slate-300 font-mono flex items-center cursor-pointer hover:bg-slate-600 transition">
                                            <svg class="w-4 h-4 mr-2 text-purple-400" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M1 0l4.2 2.4v4.8L1 4.8zm6.6 3.8l4.2 2.4v4.8l-4.2-2.4z"/>
                                            </svg>
                                            subnets_pub.tf
                                            <svg class="ml-auto chevron w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                            </svg>
                                        </summary>
                                        <pre class="!bg-slate-900"><code class="language-hcl">resource "aws_subnet" "public" {
  vpc_id                  = aws_vpc.default.id
  for_each                = local.normalized_public_subnets_all
  map_public_ip_on_launch = each.value.map_public_ip_on_launch
  cidr_block              = each.value.cidr

  assign_ipv6_address_on_creation                = each.value.assign_ipv6_address_on_creation
  customer_owned_ipv4_pool                       = each.value.customer_owned_ipv4_pool != "" ? each.value.customer_owned_ipv4_pool : null
  enable_dns64                                   = each.value.enable_dns64
  enable_resource_name_dns_aaaa_record_on_launch = each.value.enable_resource_name_dns_aaaa_record_on_launch
  enable_resource_name_dns_a_record_on_launch    = each.value.enable_resource_name_dns_a_record_on_launch
  ipv6_cidr_block                                = each.value.ipv6_cidr_block != "" ? each.value.ipv6_cidr_block : null
  ipv6_native                                    = each.value.ipv6_native
  map_customer_owned_ip_on_launch                = each.value.map_customer_owned_ip_on_launch ? each.value.map_customer_owned_ip_on_launch : null
  outpost_arn                                    = each.value.outpost_arn != "" ? each.value.outpost_arn : null
  private_dns_hostname_type_on_launch            = each.value.private_dns_hostname_type_on_launch != "" ? each.value.private_dns_hostname_type_on_launch : null


  availability_zone_id = length(regexall("^[a-z]{2}-", each.value.az)) == 0 ? each.value.az : null
  availability_zone    = length(regexall("^[a-z]{2}-", each.value.az)) > 0 ? each.value.az : null

  tags = merge(var.tags_default, { "Name" = each.value.name }, { "type" = each.value.type }, { "subnet_key" = each.key }, { "access_type" = "public" }, each.value.tags)
}

resource "aws_route_table" "public" {
  vpc_id = aws_vpc.default.id
  tags   = merge(var.tags_default, { "access_type" = "public" })
}

resource "aws_route" "public" {
  route_table_id         = aws_route_table.public.id
  destination_cidr_block = "0.0.0.0/0"
  gateway_id             = aws_internet_gateway.default.id

  timeouts {
    create = "5m"
  }
}


resource "aws_route_table_association" "pub" {
  for_each       = var.subnets.public
  route_table_id = aws_route_table.public.id
  subnet_id      = aws_subnet.public["${each.key}"].id
}



# Local variable to flatten all NACL rules for public subnets
locals {
  public_nacl_rules = flatten([
    for subnet_key, subnet in local.normalized_public_subnets_all : [
      for rule_key, rule in subnet.nacl : {
        subnet_key = subnet_key
        rule_key   = rule_key
        rule       = rule
      }
      if length(subnet.nacl) > 0
    ]
  ])
}

# Create a Network ACL for each public subnet if nacl is defined and contains rules
resource "aws_network_acl" "public" {
  for_each = {
    for subnet_key, subnet in local.normalized_public_subnets_all :
    subnet_key => subnet
    if length(subnet.nacl) > 0
  }

  vpc_id = aws_vpc.default.id

  tags = merge(var.tags_default, {
    "Name" = "${each.value.name}-nacl"
  })
}

# Create Network ACL rules for each public subnet's NACL
resource "aws_network_acl_rule" "public_rules" {
  for_each = {
    for rule in local.public_nacl_rules :
    "${rule.subnet_key}-${rule.rule_key}-${rule.rule.rule_number}" => rule
    if length(var.subnets.public[rule.subnet_key].nacl) > 0
  }

  network_acl_id  = aws_network_acl.public[each.value.subnet_key].id
  rule_number     = each.value.rule.rule_number
  egress          = each.value.rule.egress == "true" ? true : false
  protocol        = each.value.rule.protocol
  rule_action     = each.value.rule.rule_action
  cidr_block      = each.value.rule.cidr_block != "" ? each.value.rule.cidr_block : null
  from_port       = each.value.rule.from_port != "" ? tonumber(each.value.rule.from_port) : null
  to_port         = each.value.rule.to_port != "" ? tonumber(each.value.rule.to_port) : null
  icmp_code       = each.value.rule.icmp_code != "" ? tonumber(each.value.rule.icmp_code) : null
  icmp_type       = each.value.rule.icmp_type != "" ? tonumber(each.value.rule.icmp_type) : null
  ipv6_cidr_block = each.value.rule.ipv6_cidr_block != "" ? each.value.rule.ipv6_cidr_block : null
}

# Associate the NACL with each public subnet if NACL is defined and contains rules
resource "aws_network_acl_association" "public_association" {
  for_each = {
    for subnet_key, subnet in local.normalized_public_subnets_all :
    subnet_key => subnet
    if length(subnet.nacl) > 0
  }

  subnet_id      = aws_subnet.public[each.key].id
  network_acl_id = aws_network_acl.public[each.key].id
}
</code></pre>
                                    </details>
                                    
                                    <details class="bg-slate-800 rounded-lg overflow-hidden">
                                        <summary class="px-3 py-2 bg-slate-700 text-xs text-slate-300 font-mono flex items-center cursor-pointer hover:bg-slate-600 transition">
                                            <svg class="w-4 h-4 mr-2 text-purple-400" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M1 0l4.2 2.4v4.8L1 4.8zm6.6 3.8l4.2 2.4v4.8l-4.2-2.4z"/>
                                            </svg>
                                            outputs.tf
                                            <svg class="ml-auto chevron w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                            </svg>
                                        </summary>
                                        <pre class="!bg-slate-900"><code class="language-hcl"># inputs
output "tags_default" {
  description = "Default tags"
  value       = var.tags_default
}

output "subnets_var" {
  description = "for test"
  value       = var.subnets
}
output "vpc_var" {
  value = var.vpc
}

# vpc
output "vpc_raw" {
  value = try(aws_vpc.default, null)
}


# debug
output "az_mapping" {
  value = local.az_mapping
}


#subnets public

output "normalized_public_subnets_all" {
  value = local.normalized_public_subnets_all
}

output "subnets_public_raw" {
  value = try(aws_subnet.public, null)
}
output "public_subnets_by_type" {
  value = local.public_subnets_by_type
}

output "public_subnets_by_az" {
  value = local.public_subnets_by_az_output
}

output "public_subnets_by_az_id" {
  value = local.public_subnets_by_az_id
}
#subnets private
output "normalized_private_subnets_all" {
  value = local.normalized_private_subnets_all
}

output "subnets_private_raw" {
  value = try(aws_subnet.private, null)
}

output "private_subnets_by_type" {
  value = local.private_subnets_by_type
}

output "private_subnets_by_az" {
  value = local.private_subnets_by_az_output
}

output "private_subnets_by_az_id" {
  value = local.private_subnets_by_az_id
}

# NACL
output "nacl_default_rules_raw" {
  value = aws_network_acl_rule.default
}
output "public_nacl_raw" {
  value = try(aws_network_acl.public, null)

}
output "public_nacl_rules_raw" {
  value = aws_network_acl_rule.public_rules
}


output "private_nacl_raw" {
  value = try(aws_network_acl.private, null)
}
output "private_nacl_rules_raw" {
  value = aws_network_acl_rule.private_rules
}

# NAT Gateway

output "nat_gateway_single_raw" {
  value = try(aws_nat_gateway.SINGLE_nat_gateway, null)
}

output "nat_gateway_subnet_raw" {
  value = try(aws_nat_gateway.SUBNET_nat_gateway, null)
}

output "nat_gateway_az_raw" {
  value = try(aws_nat_gateway.az_nat_gateway, null)
}

# Route Table
output "route_table_private_raw" {
  value = try(aws_route_table.private, null)
}

output "route_table_public_raw" {
  value = try(aws_route_table.public, null)
}
</code></pre>
                                    </details>
                                    
                                </div>
                            </div>
                            

                            <!-- Generated Test Application -->
                            
                            <div>
                                <h4 class="text-sm font-semibold text-slate-300 mb-2 flex items-center justify-between">
                                    <span class="flex items-center">
                                        <svg class="w-4 h-4 mr-2 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/>
                                        </svg>
                                        Generated Test Application
                                    </span>
                                    
                                    <a href="https://github.com/lazarkanelov/ls-arch-artifacts /tree/main/apps/5f63fc2a95796608" target="_blank" class="text-xs text-green-400 hover:text-green-300 flex items-center">
                                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                                        </svg>
                                        View in Artifact Repo
                                    </a>
                                    
                                </h4>

                                <!-- Test Coverage Features -->
                                
                                <div class="mb-3">
                                    <span class="text-xs text-slate-500 mr-2">Test Coverage:</span>
                                    
                                    <span class="px-2 py-1 text-xs bg-purple-900/30 text-purple-300 rounded border border-purple-800/50 mr-1">
                                        AWS SDK
                                    </span>
                                    
                                    <span class="px-2 py-1 text-xs bg-purple-900/30 text-purple-300 rounded border border-purple-800/50 mr-1">
                                        Assertions
                                    </span>
                                    
                                    <span class="px-2 py-1 text-xs bg-purple-900/30 text-purple-300 rounded border border-purple-800/50 mr-1">
                                        Fixtures
                                    </span>
                                    
                                </div>
                                

                                <div class="space-y-3">
                                    
                                    <details class="bg-slate-800 rounded-lg overflow-hidden">
                                        <summary class="px-3 py-2 bg-slate-700 text-xs text-slate-300 font-mono flex items-center cursor-pointer hover:bg-slate-600 transition">
                                            <svg class="w-4 h-4 mr-2 text-green-400" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M14.25 2.26l.756-.005C17.77 2.24 18 2.308 18 3.11V4h-4V2.26zM20 8v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4a2 2 0 012-2h6.25v4H20v2z"/>
                                            </svg>
                                            test_app.py
                                            <svg class="ml-auto chevron w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                            </svg>
                                        </summary>
                                        <pre class="!bg-slate-900"><code class="language-python">import pytest
import time
from typing import Dict, List, Any
from app import NetworkInfrastructureManager, NetworkResource


class TestNetworkInfrastructure:
    """Test suite for network infrastructure management and deployments."""
    
    def test_vpc_infrastructure_exists(self, ec2_client, infrastructure_config):
        """Test that VPC infrastructure components exist after Terraform apply."""
        vpc_name = infrastructure_config["vpc"]["name"]
        
        # Check VPC exists
        vpcs = ec2_client.describe_vpcs(
            Filters=[{"Name": "tag:Name", "Values": [vpc_name]}]
        )
        assert len(vpcs["Vpcs"]) == 1, f"VPC '{vpc_name}' should exist"
        
        vpc = vpcs["Vpcs"][0]
        assert vpc["State"] == "available", "VPC should be in available state"
        assert vpc["CidrBlock"] == infrastructure_config["vpc"]["cidr"]
        
        # Check Internet Gateway exists
        igws = ec2_client.describe_internet_gateways(
            Filters=[{"Name": "attachment.vpc-id", "Values": [vpc["VpcId"]]}]
        )
        assert len(igws["InternetGateways"]) == 1, "Internet Gateway should exist"
        assert igws["InternetGateways"][0]["State"] == "available"
    
    def test_subnet_configuration_validation(self, ec2_client, infrastructure_config):
        """Test that subnets are configured correctly according to specification."""
        vpc_name = infrastructure_config["vpc"]["name"]
        
        # Get VPC ID
        vpcs = ec2_client.describe_vpcs(
            Filters=[{"Name": "tag:Name", "Values": [vpc_name]}]
        )
        vpc_id = vpcs["Vpcs"][0]["VpcId"]
        
        # Get all subnets
        subnets = ec2_client.describe_subnets(
            Filters=[{"Name": "vpc-id", "Values": [vpc_id]}]
        )
        
        subnet_count = len(subnets["Subnets"])
        expected_count = (len(infrastructure_config["subnets"]["public"]) + 
                         len(infrastructure_config["subnets"]["private"]))
        assert subnet_count == expected_count, f"Expected {expected_count} subnets, found {subnet_count}"
        
        # Verify subnet properties
        subnet_by_name = {}
        for subnet in subnets["Subnets"]:
            name = next((tag["Value"] for tag in subnet.get("Tags", []) 
                        if tag["Key"] == "Name"), None)
            if name:
                subnet_by_name[name] = subnet
        
        # Check public subnets
        for subnet_key, subnet_config in infrastructure_config["subnets"]["public"].items():
            subnet_name = subnet_config["name"]
            assert subnet_name in subnet_by_name, f"Public subnet '{subnet_name}' should exist"
            
            subnet = subnet_by_name[subnet_name]
            assert subnet["CidrBlock"] == subnet_config["cidr"]
            assert subnet["AvailabilityZone"] == subnet_config["az"]
            assert subnet["MapPublicIpOnLaunch"] is True, "Public subnets should map public IPs"
        
        # Check private subnets
        for subnet_key, subnet_config in infrastructure_config["subnets"]["private"].items():
            subnet_name = subnet_config["name"]
            assert subnet_name in subnet_by_name, f"Private subnet '{subnet_name}' should exist"
            
            subnet = subnet_by_name[subnet_name]
            assert subnet["CidrBlock"] == subnet_config["cidr"]
            assert subnet["AvailabilityZone"] == subnet_config["az"]
    
    def test_infrastructure_discovery_workflow(self, infrastructure_config):
        """Test the complete infrastructure discovery workflow."""
        manager = NetworkInfrastructureManager()
        vpc_name = infrastructure_config["vpc"]["name"]
        
        # Discover infrastructure
        infrastructure = manager.discover_vpc_infrastructure(vpc_name)
        
        # Validate discovery results
        assert infrastructure["vpc"].name == vpc_name
        assert infrastructure["vpc"].cidr == infrastructure_config["vpc"]["cidr"]
        assert infrastructure["vpc"].state == "available"
        
        # Check subnet categorization
        assert len(infrastructure["subnets"]["public"]) > 0, "Should discover public subnets"
        assert len(infrastructure["subnets"]["private"]) > 0, "Should discover private subnets"
        
        # Verify subnet details
        all_subnets = infrastructure["subnets"]["public"] + infrastructure["subnets"]["private"]
        for subnet in all_subnets:
            assert subnet.id is not None
            assert subnet.name is not None
            assert subnet.cidr is not None
            assert subnet.availability_zone is not None
            assert subnet.state == "available"
        
        # Check Internet Gateway
        assert infrastructure["internet_gateway"] is not None
        assert infrastructure["internet_gateway"].id.startswith("igw-")
    
    def test_security_group_creation_and_rules(self, infrastructure_config):
        """Test security group creation with proper tier isolation."""
        manager = NetworkInfrastructureManager()
        vpc_name = infrastructure_config["vpc"]["name"]
        
        # Discover infrastructure to get VPC ID
        infrastructure = manager.discover_vpc_infrastructure(vpc_name)
        vpc_id = infrastructure["vpc"].id
        
        # Create web tier security group
        web_sg_id = manager.create_security_group(
            vpc_id=vpc_id,
            name="test-web-sg",
            description="Test web tier security group",
            ingress_rules=[
                {
                    "IpProtocol": "tcp",
                    "FromPort": 80,
                    "ToPort": 80,
                    "IpRanges": [{"CidrIp": "0.0.0.0/0"}]
                },
                {
                    "IpProtocol": "tcp",
                    "FromPort": 443,
                    "ToPort": 443,
                    "IpRanges": [{"CidrIp": "0.0.0.0/0"}]
                }
            ]
        )
        
        assert web_sg_id is not None
        assert web_sg_id.startswith("sg-")
        
        # Verify security group rules
        response = manager.ec2_client.describe_security_groups(GroupIds=[web_sg_id])
        security_group = response["SecurityGroups"][0]
        
        assert len(security_group["IpPermissions"]) == 2
        
        # Check HTTP rule
        http_rule = next((rule for rule in security_group["IpPermissions"] 
                         if rule["FromPort"] == 80), None)
        assert http_rule is not None
        assert http_rule["IpProtocol"] == "tcp"
        assert "0.0.0.0/0" in [ip_range["CidrIp"] for ip_range in http_rule["IpRanges"]]
        
        # Check HTTPS rule
        https_rule = next((rule for rule in security_group["IpPermissions"] 
                          if rule["FromPort"] == 443), None)
        assert https_rule is not None
        assert https_rule["IpProtocol"] == "tcp"
    
    def test_multi_tier_application_deployment(self, infrastructure_config):
        """Test deploying a complete multi-tier application."""
        manager = NetworkInfrastructureManager()
        vpc_name = infrastructure_config["vpc"]["name"]
        
        # Discover infrastructure
        infrastructure = manager.discover_vpc_infrastructure(vpc_name)
        
        # Define application configuration
        app_config = {
            "web": {
                "instances_per_subnet": 1,
                "instance_type": "t3.micro",
                "ami_id": "ami-0c02fb55956c7d316"
            },
            "app": {
                "instances_per_subnet": 1,
                "instance_type": "t3.micro",
                "ami_id": "ami-0c02fb55956c7d316"
            },
            "database": {
                "instances_per_subnet": 1,
                "instance_type": "t3.micro",
                "ami_id": "ami-0c02fb55956c7d316"
            }
        }
        
        # Deploy application
        deployments = manager.deploy_multi_tier_application(infrastructure, app_config)
        
        try:
            # Validate deployment results
            assert "web" in deployments, "Web tier should be deployed"
            assert "app" in deployments, "App tier should be deployed"
            assert "database" in deployments, "Database tier should be deployed"
            
            # Check instance counts
            web_instances = deployments["web"]
            app_instances = deployments["app"]
            db_instances = deployments["database"]
            
            assert len(web_instances) > 0, "Web tier should have instances"
            assert len(app_instances) > 0, "App tier should have instances"
            assert len(db_instances) > 0, "Database tier should have instances"
            
            # Verify instances are running
            all_instance_ids = web_instances + app_instances + db_instances
            
            response = manager.ec2_client.describe_instances(InstanceIds=all_instance_ids)
            running_count = 0
            for reservation in response["Reservations"]:
                for instance in reservation["Instances"]:
                    if instance["State"]["Name"] in ["pending", "running"]:
                        running_count += 1
            
            assert running_count == len(all_instance_ids), "All instances should be pending or running"
            
            # Validate instance placement
            for reservation in response["Reservations"]:
                for instance in reservation["Instances"]:
                    tier_tag = next((tag["Value"] for tag in instance.get("Tags", []) 
                                   if tag["Key"] == "Tier"), None)
                    assert tier_tag in ["web", "app", "database"], "Instance should have valid tier tag"
                    
                    # Web instances should be in public subnets
                    if tier_tag == "web":
                        public_subnet_ids = [s.id for s in infrastructure["subnets"]["public"]]
                        assert instance["SubnetId"] in public_subnet_ids, "Web instances should be in public subnets"
                    
                    # App and DB instances should be in private subnets
                    elif tier_tag in ["app", "database"]:
                        private_subnet_ids = [s.id for s in infrastructure["subnets"]["private"]]
                        assert instance["SubnetId"] in private_subnet_ids, "App/DB instances should be in private subnets"
        
        finally:
            # Clean up instances
            all_instance_ids = []
            for tier_instances in deployments.values():
                all_instance_ids.extend(tier_instances)
            
            if all_instance_ids:
                manager.cleanup_deployment(all_instance_ids)
    
    def test_network_connectivity_validation(self, infrastructure_config):
        """Test comprehensive network connectivity validation."""
        manager = NetworkInfrastructureManager()
        vpc_name = infrastructure_config["vpc"]["name"]
        
        # Discover infrastructure
        infrastructure = manager.discover_vpc_infrastructure(vpc_name)
        
        # Run connectivity validation
        results = manager.validate_network_connectivity(infrastructure)
        
        # Validate test results
        assert isinstance(results, dict), "Results should be a dictionary"
        assert len(results) > 0, "Should have connectivity test results"
        
        # Check specific connectivity tests
        assert "vpc_dns_enabled" in results, "Should test VPC DNS settings"
        assert "public_internet_access" in results, "Should test public internet access"
        assert "cross_az_connectivity" in results, "Should test cross-AZ connectivity"
        
        # VPC should have DNS enabled
        assert results["vpc_dns_enabled"] is True, "VPC should have DNS support enabled"
        
        # Should have cross-AZ connectivity (multiple AZs)
        assert results["cross_az_connectivity"] is True, "Should have subnets in multiple AZs"
        
        # Log results for debugging
        for test_name, test_result in results.items():
            print(f"Connectivity test '{test_name}': {'PASS' if test_result else 'FAIL'}")
    
    def test_high_availability_deployment_pattern(self, infrastructure_config):
        """Test deploying applications across multiple availability zones for high availability."""
        manager = NetworkInfrastructureManager()
        vpc_name = infrastructure_config["vpc"]["name"]
        
        # Discover infrastructure
        infrastructure = manager.discover_vpc_infrastructure(vpc_name)
        
        # Count availability zones
        public_azs = set(subnet.availability_zone for subnet in infrastructure["subnets"]["public"])
        private_azs = set(subnet.availability_zone for subnet in infrastructure["subnets"]["private"])
        
        assert len(public_azs) >= 2, "Should have public subnets in at least 2 AZs for HA"
        assert len(private_azs) >= 2, "Should have private subnets in at least 2 AZs for HA"
        
        # Deploy HA configuration
        app_config = {
            "web": {
                "instances_per_subnet": 1,  # One instance per subnet for HA
                "instance_type": "t3.micro",
                "ami_id": "ami-0c02fb55956c7d316"
            }
        }
        
        deployments = manager.deploy_multi_tier_application(infrastructure, app_config)
        
        try:
            web_instances = deployments["web"]
            
            # Verify instances are distributed across AZs
            response = manager.ec2_client.describe_instances(InstanceIds=web_instances)
            instance_azs = set()
            
            for reservation in response["Reservations"]:
                for instance in reservation["Instances"]:
                    instance_azs.add(instance["Placement"]["AvailabilityZone"])
            
            assert len(instance_azs) >= 2, "Web instances should be distributed across multiple AZs"
            
        finally:
            # Clean up
            all_instance_ids = []
            for tier_instances in deployments.values():
                all_instance_ids.extend(tier_instances)
            
            if all_instance_ids:
                manager.cleanup_deployment(all_instance_ids)
    
    def test_nat_gateway_configuration(self, infrastructure_config):
        """Test NAT Gateway configuration for private subnet internet access."""
        manager = NetworkInfrastructureManager()
        vpc_name = infrastructure_config["vpc"]["name"]
        
        # Discover infrastructure
        infrastructure = manager.discover_vpc_infrastructure(vpc_name)
        
        # Check NAT Gateway presence
        nat_gateways = infrastructure["nat_gateways"]
        
        if len(infrastructure["subnets"]["private"]) > 0:
            # Should have NAT Gateways for private subnet internet access
            # Note: This depends on the Terraform configuration actually creating NAT Gateways
            print(f"Found {len(nat_gateways)} NAT Gateway(s)")
            
            # Verify NAT Gateway placement in public subnets
            if nat_gateways:
                public_subnet_ids = [s.id for s in infrastructure["subnets"]["public"]]
                
                nat_gateway_details = manager.ec2_client.describe_nat_gateways(
                    NatGatewayIds=[ng.id for ng in nat_gateways]
                )
                
                for nat_gw in nat_gateway_details["NatGateways"]:
                    assert nat_gw["SubnetId"] in public_subnet_ids, "NAT Gateway should be in public subnet"
                    assert nat_gw["State"] in ["pending", "available"], "NAT Gateway should be available"
    
    def test_error_handling_and_resilience(self, infrastructure_config):
        """Test error handling and resilience of the network management system."""
        manager = NetworkInfrastructureManager()
        
        # Test 1: Invalid VPC name
        with pytest.raises(ValueError, match="VPC with name .* not found"):
            manager.discover_vpc_infrastructure("nonexistent-vpc")
        
        # Test 2: Duplicate security group creation
        vpc_name = infrastructure_config["vpc"]["name"]
        infrastructure = manager.discover_vpc_infrastructure(vpc_name)
        vpc_id = infrastructure["vpc"].id
        
        # Create security group
        sg_name = "test-duplicate-sg"
        sg_id_1 = manager.create_security_group(
            vpc_id=vpc_id,
            name=sg_name,
            description="Test duplicate security group",
            ingress_rules=[]
        )
        
        # Try to create same security group again (should handle gracefully)
        sg_id_2 = manager.create_security_group(
            vpc_id=vpc_id,
            name=sg_name,
            description="Test duplicate security group",
            ingress_rules=[]
        )
        
        assert sg_id_1 == sg_id_2, "Should return existing security group ID"
        
        # Test 3: Cleanup with empty instance list
        result = manager.cleanup_deployment([])
        assert result is True, "Cleanup should handle empty instance list gracefully"</code></pre>
                                    </details>
                                    
                                    <details class="bg-slate-800 rounded-lg overflow-hidden">
                                        <summary class="px-3 py-2 bg-slate-700 text-xs text-slate-300 font-mono flex items-center cursor-pointer hover:bg-slate-600 transition">
                                            <svg class="w-4 h-4 mr-2 text-green-400" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M14.25 2.26l.756-.005C17.77 2.24 18 2.308 18 3.11V4h-4V2.26zM20 8v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4a2 2 0 012-2h6.25v4H20v2z"/>
                                            </svg>
                                            conftest.py
                                            <svg class="ml-auto chevron w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                            </svg>
                                        </summary>
                                        <pre class="!bg-slate-900"><code class="language-python">import os
import boto3
import pytest
from typing import Dict, Any


@pytest.fixture(scope="session")
def aws_config() -> Dict[str, str]:
    """AWS configuration for LocalStack."""
    return {
        "endpoint_url": os.environ.get("LOCALSTACK_ENDPOINT", "http://localhost:4566"),
        "region_name": "us-east-1",
        "aws_access_key_id": "test",
        "aws_secret_access_key": "test"
    }


@pytest.fixture(scope="session")
def ec2_client(aws_config):
    """EC2 client for LocalStack."""
    return boto3.client("ec2", **aws_config)


@pytest.fixture(scope="session")
def vpc_name() -> str:
    """VPC name from Terraform configuration."""
    return "test-vpc"


@pytest.fixture(scope="session")
def infrastructure_config() -> Dict[str, Any]:
    """Infrastructure configuration that matches Terraform variables."""
    return {
        "vpc": {
            "name": "test-vpc",
            "cidr": "10.0.0.0/16",
            "tags": {"Environment": "test", "Project": "networking"}
        },
        "subnets": {
            "public": {
                "web-subnet-1a": {
                    "name": "web-subnet-1a",
                    "cidr": "10.0.1.0/24",
                    "az": "us-east-1a",
                    "type": "web",
                    "tags": {"Tier": "web"}
                },
                "web-subnet-1b": {
                    "name": "web-subnet-1b",
                    "cidr": "10.0.2.0/24",
                    "az": "us-east-1b",
                    "type": "web",
                    "tags": {"Tier": "web"}
                }
            },
            "private": {
                "app-subnet-1a": {
                    "name": "app-subnet-1a",
                    "cidr": "10.0.11.0/24",
                    "az": "us-east-1a",
                    "type": "app",
                    "nat_gateway": "AZ",
                    "tags": {"Tier": "app"}
                },
                "app-subnet-1b": {
                    "name": "app-subnet-1b",
                    "cidr": "10.0.12.0/24",
                    "az": "us-east-1b",
                    "type": "app",
                    "nat_gateway": "AZ",
                    "tags": {"Tier": "app"}
                },
                "db-subnet-1a": {
                    "name": "db-subnet-1a",
                    "cidr": "10.0.21.0/24",
                    "az": "us-east-1a",
                    "type": "db",
                    "nat_gateway": "SINGLE",
                    "tags": {"Tier": "database"}
                },
                "db-subnet-1b": {
                    "name": "db-subnet-1b",
                    "cidr": "10.0.22.0/24",
                    "az": "us-east-1b",
                    "type": "db",
                    "nat_gateway": "SINGLE",
                    "tags": {"Tier": "database"}
                }
            }
        }
    }


@pytest.fixture(scope="session")
def test_instances_config() -> Dict[str, Any]:
    """Configuration for test EC2 instances."""
    return {
        "ami_id": "ami-0c02fb55956c7d316",  # Amazon Linux 2 AMI
        "instance_type": "t3.micro",
        "key_pair_name": "test-key-pair"
    }</code></pre>
                                    </details>
                                    
                                    <details class="bg-slate-800 rounded-lg overflow-hidden">
                                        <summary class="px-3 py-2 bg-slate-700 text-xs text-slate-300 font-mono flex items-center cursor-pointer hover:bg-slate-600 transition">
                                            <svg class="w-4 h-4 mr-2 text-green-400" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M14.25 2.26l.756-.005C17.77 2.24 18 2.308 18 3.11V4h-4V2.26zM20 8v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4a2 2 0 012-2h6.25v4H20v2z"/>
                                            </svg>
                                            app.py
                                            <svg class="ml-auto chevron w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                            </svg>
                                        </summary>
                                        <pre class="!bg-slate-900"><code class="language-python">import boto3
import os
import time
import logging
from typing import Dict, List, Optional, Tuple, Any
from dataclasses import dataclass
from botocore.exceptions import ClientError

# Configure logging
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)


@dataclass
class NetworkResource:
    """Represents a network resource with its attributes."""
    id: str
    name: str
    cidr: Optional[str] = None
    availability_zone: Optional[str] = None
    state: Optional[str] = None
    tags: Optional[Dict[str, str]] = None


@dataclass
class InstanceDeployment:
    """Represents an EC2 instance deployment configuration."""
    name: str
    subnet_id: str
    security_group_ids: List[str]
    instance_type: str = "t3.micro"
    ami_id: str = "ami-0c02fb55956c7d316"
    user_data: Optional[str] = None


class NetworkInfrastructureManager:
    """Manages network infrastructure operations and EC2 deployments."""
    
    def __init__(self):
        """Initialize the network infrastructure manager."""
        self.aws_config = {
            "endpoint_url": os.environ.get("LOCALSTACK_ENDPOINT", "http://localhost:4566"),
            "region_name": "us-east-1",
            "aws_access_key_id": "test",
            "aws_secret_access_key": "test"
        }
        self.ec2_client = boto3.client("ec2", **self.aws_config)
        self.ec2_resource = boto3.resource("ec2", **self.aws_config)
        
    def discover_vpc_infrastructure(self, vpc_name: str) -> Dict[str, Any]:
        """Discover and catalog VPC infrastructure components.
        
        Args:
            vpc_name: Name of the VPC to discover
            
        Returns:
            Dictionary containing VPC infrastructure details
        """
        try:
            # Find VPC by name
            vpcs = self.ec2_client.describe_vpcs(
                Filters=[{"Name": "tag:Name", "Values": [vpc_name]}]
            )
            
            if not vpcs["Vpcs"]:
                raise ValueError(f"VPC with name '{vpc_name}' not found")
            
            vpc = vpcs["Vpcs"][0]
            vpc_id = vpc["VpcId"]
            
            logger.info(f"Discovered VPC: {vpc_id} ({vpc_name})")
            
            # Discover subnets
            subnets_response = self.ec2_client.describe_subnets(
                Filters=[{"Name": "vpc-id", "Values": [vpc_id]}]
            )
            
            infrastructure = {
                "vpc": NetworkResource(
                    id=vpc_id,
                    name=vpc_name,
                    cidr=vpc["CidrBlock"],
                    state=vpc["State"],
                    tags=self._extract_tags(vpc.get("Tags", []))
                ),
                "subnets": {
                    "public": [],
                    "private": []
                },
                "internet_gateway": None,
                "nat_gateways": [],
                "route_tables": []
            }
            
            # Categorize subnets
            for subnet in subnets_response["Subnets"]:
                subnet_obj = NetworkResource(
                    id=subnet["SubnetId"],
                    name=self._get_tag_value(subnet.get("Tags", []), "Name"),
                    cidr=subnet["CidrBlock"],
                    availability_zone=subnet["AvailabilityZone"],
                    state=subnet["State"],
                    tags=self._extract_tags(subnet.get("Tags", []))
                )
                
                # Determine if subnet is public or private based on route table
                if subnet["MapPublicIpOnLaunch"]:
                    infrastructure["subnets"]["public"].append(subnet_obj)
                else:
                    infrastructure["subnets"]["private"].append(subnet_obj)
            
            # Discover Internet Gateway
            igws = self.ec2_client.describe_internet_gateways(
                Filters=[{"Name": "attachment.vpc-id", "Values": [vpc_id]}]
            )
            
            if igws["InternetGateways"]:
                igw = igws["InternetGateways"][0]
                infrastructure["internet_gateway"] = NetworkResource(
                    id=igw["InternetGatewayId"],
                    name=self._get_tag_value(igw.get("Tags", []), "Name"),
                    tags=self._extract_tags(igw.get("Tags", []))
                )
            
            # Discover NAT Gateways
            nat_gws = self.ec2_client.describe_nat_gateways(
                Filters=[{"Name": "vpc-id", "Values": [vpc_id]}]
            )
            
            for nat_gw in nat_gws["NatGateways"]:
                if nat_gw["State"] != "deleted":
                    infrastructure["nat_gateways"].append(
                        NetworkResource(
                            id=nat_gw["NatGatewayId"],
                            name=self._get_tag_value(nat_gw.get("Tags", []), "Name"),
                            tags=self._extract_tags(nat_gw.get("Tags", []))
                        )
                    )
            
            logger.info(f"Infrastructure discovery complete: {len(infrastructure['subnets']['public'])} public subnets, {len(infrastructure['subnets']['private'])} private subnets")
            return infrastructure
            
        except ClientError as e:
            logger.error(f"AWS error during infrastructure discovery: {e}")
            raise
        except Exception as e:
            logger.error(f"Error discovering infrastructure: {e}")
            raise
    
    def create_security_group(self, vpc_id: str, name: str, description: str, 
                            ingress_rules: List[Dict[str, Any]]) -> str:
        """Create a security group with specified rules.
        
        Args:
            vpc_id: VPC ID to create the security group in
            name: Security group name
            description: Security group description
            ingress_rules: List of ingress rules
            
        Returns:
            Security group ID
        """
        try:
            response = self.ec2_client.create_security_group(
                GroupName=name,
                Description=description,
                VpcId=vpc_id,
                TagSpecifications=[
                    {
                        "ResourceType": "security-group",
                        "Tags": [
                            {"Key": "Name", "Value": name}
                        ]
                    }
                ]
            )
            
            sg_id = response["GroupId"]
            logger.info(f"Created security group: {sg_id} ({name})")
            
            # Add ingress rules
            if ingress_rules:
                self.ec2_client.authorize_security_group_ingress(
                    GroupId=sg_id,
                    IpPermissions=ingress_rules
                )
                logger.info(f"Added {len(ingress_rules)} ingress rules to {sg_id}")
            
            return sg_id
            
        except ClientError as e:
            if e.response["Error"]["Code"] == "InvalidGroup.Duplicate":
                logger.warning(f"Security group {name} already exists")
                # Find existing security group
                sgs = self.ec2_client.describe_security_groups(
                    Filters=[
                        {"Name": "group-name", "Values": [name]},
                        {"Name": "vpc-id", "Values": [vpc_id]}
                    ]
                )
                return sgs["SecurityGroups"][0]["GroupId"]
            logger.error(f"Error creating security group: {e}")
            raise
    
    def deploy_multi_tier_application(self, infrastructure: Dict[str, Any], 
                                    app_config: Dict[str, Any]) -> Dict[str, List[str]]:
        """Deploy a multi-tier application across the network infrastructure.
        
        Args:
            infrastructure: Infrastructure details from discovery
            app_config: Application deployment configuration
            
        Returns:
            Dictionary mapping tier names to instance IDs
        """
        deployments = {}
        
        try:
            vpc_id = infrastructure["vpc"].id
            
            # Create security groups for different tiers
            security_groups = self._create_tier_security_groups(vpc_id)
            
            # Deploy web tier in public subnets
            if "web" in app_config:
                web_instances = self._deploy_tier(
                    "web",
                    infrastructure["subnets"]["public"],
                    security_groups["web"],
                    app_config["web"]
                )
                deployments["web"] = web_instances
            
            # Deploy app tier in private subnets (app type)
            if "app" in app_config:
                app_subnets = [
                    subnet for subnet in infrastructure["subnets"]["private"]
                    if subnet.tags and subnet.tags.get("Tier") == "app"
                ]
                app_instances = self._deploy_tier(
                    "app",
                    app_subnets,
                    security_groups["app"],
                    app_config["app"]
                )
                deployments["app"] = app_instances
            
            # Deploy database tier in private subnets (db type)
            if "database" in app_config:
                db_subnets = [
                    subnet for subnet in infrastructure["subnets"]["private"]
                    if subnet.tags and subnet.tags.get("Tier") == "database"
                ]
                db_instances = self._deploy_tier(
                    "database",
                    db_subnets,
                    security_groups["database"],
                    app_config["database"]
                )
                deployments["database"] = db_instances
            
            logger.info(f"Multi-tier deployment complete: {sum(len(instances) for instances in deployments.values())} total instances")
            return deployments
            
        except Exception as e:
            logger.error(f"Error during multi-tier deployment: {e}")
            raise
    
    def validate_network_connectivity(self, infrastructure: Dict[str, Any]) -> Dict[str, bool]:
        """Validate network connectivity between different tiers.
        
        Args:
            infrastructure: Infrastructure details
            
        Returns:
            Dictionary of connectivity test results
        """
        results = {}
        
        try:
            vpc_id = infrastructure["vpc"].id
            
            # Test 1: VPC DNS resolution
            results["vpc_dns_enabled"] = self._check_vpc_dns_settings(vpc_id)
            
            # Test 2: Public subnet internet connectivity
            results["public_internet_access"] = self._validate_public_internet_access(
                infrastructure["subnets"]["public"]
            )
            
            # Test 3: Private subnet NAT gateway connectivity
            results["private_nat_access"] = self._validate_private_nat_access(
                infrastructure["subnets"]["private"],
                infrastructure["nat_gateways"]
            )
            
            # Test 4: Cross-AZ connectivity
            results["cross_az_connectivity"] = self._validate_cross_az_connectivity(
                infrastructure["subnets"]
            )
            
            # Test 5: Security group isolation
            results["security_isolation"] = self._validate_security_isolation(vpc_id)
            
            logger.info(f"Network connectivity validation complete: {sum(results.values())}/{len(results)} tests passed")
            return results
            
        except Exception as e:
            logger.error(f"Error during network validation: {e}")
            raise
    
    def cleanup_deployment(self, instance_ids: List[str]) -> bool:
        """Clean up deployed instances and associated resources.
        
        Args:
            instance_ids: List of instance IDs to terminate
            
        Returns:
            True if cleanup successful
        """
        try:
            if instance_ids:
                self.ec2_client.terminate_instances(InstanceIds=instance_ids)
                logger.info(f"Initiated termination of {len(instance_ids)} instances")
                
                # Wait for instances to terminate
                waiter = self.ec2_client.get_waiter('instance_terminated')
                waiter.wait(InstanceIds=instance_ids, WaiterConfig={'Delay': 5, 'MaxAttempts': 20})
                logger.info("All instances terminated successfully")
            
            return True
            
        except Exception as e:
            logger.error(f"Error during cleanup: {e}")
            return False
    
    def _extract_tags(self, tag_list: List[Dict[str, str]]) -> Dict[str, str]:
        """Extract tags from AWS tag list format."""
        return {tag["Key"]: tag["Value"] for tag in tag_list}
    
    def _get_tag_value(self, tag_list: List[Dict[str, str]], key: str) -> Optional[str]:
        """Get specific tag value from AWS tag list."""
        for tag in tag_list:
            if tag["Key"] == key:
                return tag["Value"]
        return None
    
    def _create_tier_security_groups(self, vpc_id: str) -> Dict[str, str]:
        """Create security groups for different application tiers."""
        security_groups = {}
        
        # Web tier security group (HTTP/HTTPS from internet)
        web_rules = [
            {
                "IpProtocol": "tcp",
                "FromPort": 80,
                "ToPort": 80,
                "IpRanges": [{"CidrIp": "0.0.0.0/0", "Description": "HTTP from internet"}]
            },
            {
                "IpProtocol": "tcp",
                "FromPort": 443,
                "ToPort": 443,
                "IpRanges": [{"CidrIp": "0.0.0.0/0", "Description": "HTTPS from internet"}]
            }
        ]
        
        security_groups["web"] = self.create_security_group(
            vpc_id, "web-tier-sg", "Security group for web tier", web_rules
        )
        
        # App tier security group (access from web tier)
        app_rules = [
            {
                "IpProtocol": "tcp",
                "FromPort": 8080,
                "ToPort": 8080,
                "UserIdGroupPairs": [{"GroupId": security_groups["web"], "Description": "App port from web tier"}]
            }
        ]
        
        security_groups["app"] = self.create_security_group(
            vpc_id, "app-tier-sg", "Security group for app tier", app_rules
        )
        
        # Database tier security group (access from app tier)
        db_rules = [
            {
                "IpProtocol": "tcp",
                "FromPort": 3306,
                "ToPort": 3306,
                "UserIdGroupPairs": [{"GroupId": security_groups["app"], "Description": "MySQL from app tier"}]
            }
        ]
        
        security_groups["database"] = self.create_security_group(
            vpc_id, "db-tier-sg", "Security group for database tier", db_rules
        )
        
        return security_groups
    
    def _deploy_tier(self, tier_name: str, subnets: List[NetworkResource], 
                    security_group_id: str, config: Dict[str, Any]) -> List[str]:
        """Deploy instances for a specific tier."""
        instance_ids = []
        
        instances_per_subnet = config.get("instances_per_subnet", 1)
        instance_type = config.get("instance_type", "t3.micro")
        ami_id = config.get("ami_id", "ami-0c02fb55956c7d316")
        
        for subnet in subnets:
            for i in range(instances_per_subnet):
                try:
                    response = self.ec2_client.run_instances(
                        ImageId=ami_id,
                        MinCount=1,
                        MaxCount=1,
                        InstanceType=instance_type,
                        SubnetId=subnet.id,
                        SecurityGroupIds=[security_group_id],
                        TagSpecifications=[
                            {
                                "ResourceType": "instance",
                                "Tags": [
                                    {"Key": "Name", "Value": f"{tier_name}-{subnet.availability_zone}-{i+1}"},
                                    {"Key": "Tier", "Value": tier_name},
                                    {"Key": "Environment", "Value": "test"}
                                ]
                            }
                        ]
                    )
                    
                    instance_id = response["Instances"][0]["InstanceId"]
                    instance_ids.append(instance_id)
                    logger.info(f"Launched {tier_name} instance: {instance_id} in {subnet.id}")
                    
                except ClientError as e:
                    logger.error(f"Error launching instance in {subnet.id}: {e}")
        
        return instance_ids
    
    def _check_vpc_dns_settings(self, vpc_id: str) -> bool:
        """Check VPC DNS settings."""
        try:
            response = self.ec2_client.describe_vpcs(VpcIds=[vpc_id])
            vpc = response["Vpcs"][0]
            return vpc["EnableDnsSupport"] and vpc["EnableDnsHostnames"]
        except Exception:
            return False
    
    def _validate_public_internet_access(self, public_subnets: List[NetworkResource]) -> bool:
        """Validate public subnets have internet access via IGW."""
        for subnet in public_subnets:
            if not subnet.id:
                continue
            
            try:
                # Check route tables for internet gateway route
                route_tables = self.ec2_client.describe_route_tables(
                    Filters=[
                        {"Name": "association.subnet-id", "Values": [subnet.id]}
                    ]
                )
                
                for rt in route_tables["RouteTables"]:
                    for route in rt["Routes"]:
                        if (route.get("DestinationCidrBlock") == "0.0.0.0/0" and 
                            "GatewayId" in route and route["GatewayId"].startswith("igw-")):
                            return True
                            
            except Exception:
                continue
        
        return False
    
    def _validate_private_nat_access(self, private_subnets: List[NetworkResource], 
                                   nat_gateways: List[NetworkResource]) -> bool:
        """Validate private subnets have NAT gateway access."""
        return len(nat_gateways) > 0 and len(private_subnets) > 0
    
    def _validate_cross_az_connectivity(self, subnets: Dict[str, List[NetworkResource]]) -> bool:
        """Validate cross-AZ connectivity."""
        all_azs = set()
        for subnet_list in subnets.values():
            for subnet in subnet_list:
                if subnet.availability_zone:
                    all_azs.add(subnet.availability_zone)
        
        # Should have subnets in multiple AZs for high availability
        return len(all_azs) >= 2
    
    def _validate_security_isolation(self, vpc_id: str) -> bool:
        """Validate security group isolation between tiers."""
        try:
            # Check if multiple security groups exist (indicating tier separation)
            response = self.ec2_client.describe_security_groups(
                Filters=[{"Name": "vpc-id", "Values": [vpc_id]}]
            )
            # Should have more than just the default security group
            return len(response["SecurityGroups"]) > 1
        except Exception:
            return False


def create_network_manager() -> NetworkInfrastructureManager:
    """Create a network infrastructure manager instance."""
    return NetworkInfrastructureManager()</code></pre>
                                    </details>
                                    
                                    <details class="bg-slate-800 rounded-lg overflow-hidden">
                                        <summary class="px-3 py-2 bg-slate-700 text-xs text-slate-300 font-mono flex items-center cursor-pointer hover:bg-slate-600 transition">
                                            <svg class="w-4 h-4 mr-2 text-green-400" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M14.25 2.26l.756-.005C17.77 2.24 18 2.308 18 3.11V4h-4V2.26zM20 8v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4a2 2 0 012-2h6.25v4H20v2z"/>
                                            </svg>
                                            requirements.txt
                                            <svg class="ml-auto chevron w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                            </svg>
                                        </summary>
                                        <pre class="!bg-slate-900"><code class="language-python">boto3>=1.34.0
pytest>=7.4.0
pytest-asyncio>=0.21.0
botocore>=1.34.0</code></pre>
                                    </details>
                                    
                                </div>
                            </div>
                            

                            <!-- Use Cases Tested -->
                            
                            <div>
                                <h4 class="text-sm font-semibold text-slate-300 mb-2 flex items-center">
                                    <svg class="w-4 h-4 mr-2 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                    Use Cases Tested
                                </h4>
                                <div class="bg-slate-800 rounded-lg overflow-hidden">
                                    <div class="divide-y divide-slate-700">
                                        
                                        <div class="p-3 hover:bg-slate-700/50 transition">
                                            <div class="flex items-start">
                                                <svg class="w-5 h-5 mr-2 mt-0.5 text-green-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                                </svg>
                                                <div>
                                                    <div class="font-medium text-white text-sm">Vpc Infrastructure Exists</div>
                                                    
                                                    <div class="text-xs text-slate-400 mt-1">Test that VPC infrastructure components exist after Terraform apply.</div>
                                                    
                                                    <code class="text-xs text-slate-500 mt-1 block">test_vpc_infrastructure_exists()</code>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="p-3 hover:bg-slate-700/50 transition">
                                            <div class="flex items-start">
                                                <svg class="w-5 h-5 mr-2 mt-0.5 text-green-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                                </svg>
                                                <div>
                                                    <div class="font-medium text-white text-sm">Subnet Configuration Validation</div>
                                                    
                                                    <div class="text-xs text-slate-400 mt-1">Test that subnets are configured correctly according to specification.</div>
                                                    
                                                    <code class="text-xs text-slate-500 mt-1 block">test_subnet_configuration_validation()</code>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="p-3 hover:bg-slate-700/50 transition">
                                            <div class="flex items-start">
                                                <svg class="w-5 h-5 mr-2 mt-0.5 text-green-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                                </svg>
                                                <div>
                                                    <div class="font-medium text-white text-sm">Infrastructure Discovery Workflow</div>
                                                    
                                                    <div class="text-xs text-slate-400 mt-1">Test the complete infrastructure discovery workflow.</div>
                                                    
                                                    <code class="text-xs text-slate-500 mt-1 block">test_infrastructure_discovery_workflow()</code>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="p-3 hover:bg-slate-700/50 transition">
                                            <div class="flex items-start">
                                                <svg class="w-5 h-5 mr-2 mt-0.5 text-green-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                                </svg>
                                                <div>
                                                    <div class="font-medium text-white text-sm">Security Group Creation And Rules</div>
                                                    
                                                    <div class="text-xs text-slate-400 mt-1">Test security group creation with proper tier isolation.</div>
                                                    
                                                    <code class="text-xs text-slate-500 mt-1 block">test_security_group_creation_and_rules()</code>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="p-3 hover:bg-slate-700/50 transition">
                                            <div class="flex items-start">
                                                <svg class="w-5 h-5 mr-2 mt-0.5 text-green-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                                </svg>
                                                <div>
                                                    <div class="font-medium text-white text-sm">Multi Tier Application Deployment</div>
                                                    
                                                    <div class="text-xs text-slate-400 mt-1">Test deploying a complete multi-tier application.</div>
                                                    
                                                    <code class="text-xs text-slate-500 mt-1 block">test_multi_tier_application_deployment()</code>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="p-3 hover:bg-slate-700/50 transition">
                                            <div class="flex items-start">
                                                <svg class="w-5 h-5 mr-2 mt-0.5 text-green-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                                </svg>
                                                <div>
                                                    <div class="font-medium text-white text-sm">Network Connectivity Validation</div>
                                                    
                                                    <div class="text-xs text-slate-400 mt-1">Test comprehensive network connectivity validation.</div>
                                                    
                                                    <code class="text-xs text-slate-500 mt-1 block">test_network_connectivity_validation()</code>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="p-3 hover:bg-slate-700/50 transition">
                                            <div class="flex items-start">
                                                <svg class="w-5 h-5 mr-2 mt-0.5 text-green-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                                </svg>
                                                <div>
                                                    <div class="font-medium text-white text-sm">High Availability Deployment Pattern</div>
                                                    
                                                    <div class="text-xs text-slate-400 mt-1">Test deploying applications across multiple availability zones for high availability.</div>
                                                    
                                                    <code class="text-xs text-slate-500 mt-1 block">test_high_availability_deployment_pattern()</code>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="p-3 hover:bg-slate-700/50 transition">
                                            <div class="flex items-start">
                                                <svg class="w-5 h-5 mr-2 mt-0.5 text-green-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                                </svg>
                                                <div>
                                                    <div class="font-medium text-white text-sm">Nat Gateway Configuration</div>
                                                    
                                                    <div class="text-xs text-slate-400 mt-1">Test NAT Gateway configuration for private subnet internet access.</div>
                                                    
                                                    <code class="text-xs text-slate-500 mt-1 block">test_nat_gateway_configuration()</code>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="p-3 hover:bg-slate-700/50 transition">
                                            <div class="flex items-start">
                                                <svg class="w-5 h-5 mr-2 mt-0.5 text-green-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                                </svg>
                                                <div>
                                                    <div class="font-medium text-white text-sm">Error Handling And Resilience</div>
                                                    
                                                    <div class="text-xs text-slate-400 mt-1">Test error handling and resilience of the network management system.</div>
                                                    
                                                    <code class="text-xs text-slate-500 mt-1 block">test_error_handling_and_resilience()</code>
                                                </div>
                                            </div>
                                        </div>
                                        
                                    </div>
                                </div>
                            </div>
                            

                            <!-- Test Results -->
                            <div>
                                <h4 class="text-sm font-semibold text-slate-300 mb-2 flex items-center">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                                    </svg>
                                    Test Results
                                </h4>
                                <div class="bg-slate-800 rounded-lg p-4">
                                    <div class="grid grid-cols-4 gap-4 mb-4 text-center">
                                        <div class="p-2 bg-slate-900 rounded">
                                            <div class="text-2xl font-bold text-white">0</div>
                                            <div class="text-xs text-slate-500">Total</div>
                                        </div>
                                        <div class="p-2 bg-green-900/30 rounded">
                                            <div class="text-2xl font-bold text-green-400">0</div>
                                            <div class="text-xs text-slate-500">Passed</div>
                                        </div>
                                        <div class="p-2 bg-red-900/30 rounded">
                                            <div class="text-2xl font-bold text-red-400">0</div>
                                            <div class="text-xs text-slate-500">Failed</div>
                                        </div>
                                        <div class="p-2 bg-slate-900 rounded">
                                            <div class="text-2xl font-bold text-slate-400">
                                                
                                                N/A
                                                
                                            </div>
                                            <div class="text-xs text-slate-500">Pass Rate</div>
                                        </div>
                                    </div>

                                    
                                </div>
                            </div>

                            <!-- Terraform Apply Output -->
                            
                            <div>
                                <h4 class="text-sm font-semibold text-slate-300 mb-2">Terraform Apply Output</h4>
                                <details class="bg-slate-800 rounded-lg overflow-hidden">
                                    <summary class="px-3 py-2 text-sm text-slate-400 cursor-pointer hover:bg-slate-700 transition">
                                        Show terraform apply logs
                                    </summary>
                                    <pre class="!bg-slate-900 text-xs overflow-auto max-h-64"><code class="language-bash">Terraform timed out</code></pre>
                                </details>
                            </div>
                            

                            <!-- Container Logs -->
                            
                            <div>
                                <h4 class="text-sm font-semibold text-slate-300 mb-2">LocalStack Container Logs</h4>
                                <details class="bg-slate-800 rounded-lg overflow-hidden">
                                    <summary class="px-3 py-2 text-sm text-slate-400 cursor-pointer hover:bg-slate-700 transition">
                                        Show container logs
                                    </summary>
                                    <pre class="!bg-slate-900 text-xs overflow-auto max-h-64"><code class="language-bash">02:02.532  INFO --- [et.reactor-0] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:02:02.535  INFO --- [et.reactor-2] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:02:12.542  INFO --- [et.reactor-7] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:02:12.545  INFO --- [et.reactor-5] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:02:22.556  INFO --- [et.reactor-6] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:02:22.559  INFO --- [et.reactor-3] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:02:32.565  INFO --- [et.reactor-4] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:02:32.568  INFO --- [et.reactor-0] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:02:42.582  INFO --- [et.reactor-1] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:02:42.585  INFO --- [et.reactor-7] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:02:52.596  INFO --- [et.reactor-2] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:02:52.599  INFO --- [et.reactor-6] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:03:02.611  INFO --- [et.reactor-0] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:03:02.614  INFO --- [et.reactor-5] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:03:12.619  INFO --- [et.reactor-1] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:03:12.623  INFO --- [et.reactor-3] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:03:22.626  INFO --- [et.reactor-2] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:03:22.639  INFO --- [et.reactor-4] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:03:32.646  INFO --- [et.reactor-5] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:03:32.650  INFO --- [et.reactor-7] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:03:42.662  INFO --- [et.reactor-6] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:03:42.665  INFO --- [et.reactor-1] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:03:52.679  INFO --- [et.reactor-4] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:03:52.682  INFO --- [et.reactor-0] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:04:02.695  INFO --- [et.reactor-5] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:04:02.698  INFO --- [et.reactor-3] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:04:12.701  INFO --- [et.reactor-6] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:04:12.704  INFO --- [et.reactor-2] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:04:22.717  INFO --- [et.reactor-4] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:04:22.720  INFO --- [et.reactor-7] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:04:32.732  INFO --- [et.reactor-3] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:04:32.736  INFO --- [et.reactor-1] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:04:42.748  INFO --- [et.reactor-0] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:04:42.750  INFO --- [et.reactor-2] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:04:52.765  INFO --- [et.reactor-4] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:04:52.768  INFO --- [et.reactor-5] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:05:02.771  INFO --- [et.reactor-3] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:05:02.774  INFO --- [et.reactor-6] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:05:12.790  INFO --- [et.reactor-2] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:05:12.795  INFO --- [et.reactor-0] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:05:22.803  INFO --- [et.reactor-4] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:05:22.805  INFO --- [et.reactor-5] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:05:32.811  INFO --- [et.reactor-3] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:05:32.815  INFO --- [et.reactor-6] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:05:42.818  INFO --- [et.reactor-0] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
2026-01-11T08:05:42.821  INFO --- [et.reactor-7] localstack.request.aws     : AWS ec2.DescribeSubnets => 200
</code></pre>
                                </details>
                            </div>
                            
                        </div>
                    </details>
                </div>
                
                <div class="result-card bg-slate-900 rounded-xl border border-slate-800 overflow-hidden" data-status="passed">
                    <!-- Result Header -->
                    <div class="p-4 border-b border-slate-800">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <div class="flex items-center space-x-3">
                                    <span class="px-3 py-1 text-xs font-bold text-white rounded-full status-passed">
                                        PASSED
                                    </span>
                                    <h3 class="text-lg font-semibold text-white">Simple S3 Test</h3>
                                </div>
                                <div class="mt-2 flex items-center space-x-4 text-sm text-slate-400">
                                    <span title="Architecture Hash">
                                        <svg class="inline w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14"/>
                                        </svg>
                                        simple_s3_test
                                    </span>
                                    <span title="Duration">
                                        <svg class="inline w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        </svg>
                                        60.0s
                                    </span>
                                    
                                    <a href="local://simple_s3_test" target="_blank" class="text-blue-400 hover:text-blue-300">
                                        <svg class="inline w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                                        </svg>
                                        Source
                                    </a>
                                    
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-sm">
                                    <span class="text-green-400 font-semibold">0</span>
                                    <span class="text-slate-500">/</span>
                                    <span class="text-red-400 font-semibold">0</span>
                                    <span class="text-slate-500 ml-1">tests</span>
                                </div>
                            </div>
                        </div>

                        <!-- Services Tags -->
                        <div class="mt-3 flex flex-wrap gap-2">
                            
                            <span class="px-2 py-1 text-xs bg-blue-900/30 text-blue-300 rounded border border-blue-800/50">
                                s3
                            </span>
                            
                        </div>
                    </div>

                    <!-- Failure Analysis (prominently displayed for failed architectures) -->
                    

                    <!-- Expandable Details -->
                    <details class="group">
                        <summary class="px-4 py-3 bg-slate-800/50 hover:bg-slate-800 cursor-pointer flex items-center justify-between transition">
                            <span class="text-sm font-medium text-slate-300">View Details</span>
                            <svg class="chevron w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                            </svg>
                        </summary>

                        <div class="p-4 space-y-6">
                            <!-- Source Information -->
                            
                            <div>
                                <h4 class="text-sm font-semibold text-slate-300 mb-2 flex items-center">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/>
                                    </svg>
                                    Source Information
                                </h4>
                                <div class="bg-slate-800 rounded-lg p-4">
                                    <dl class="grid grid-cols-2 gap-4 text-sm">
                                        <div>
                                            <dt class="text-slate-500">Source Type</dt>
                                            <dd class="text-white">custom</dd>
                                        </div>
                                        <div>
                                            <dt class="text-slate-500">Original Format</dt>
                                            <dd class="text-white">terraform</dd>
                                        </div>
                                        <div class="col-span-2">
                                            <dt class="text-slate-500">Source URL</dt>
                                            <dd><a href="local://simple_s3_test" target="_blank" class="text-blue-400 hover:underline break-all">local://simple_s3_test</a></dd>
                                        </div>
                                    </dl>
                                </div>
                            </div>
                            

                            <!-- Terraform Files -->
                            
                            <div>
                                <h4 class="text-sm font-semibold text-slate-300 mb-2 flex items-center justify-between">
                                    <span class="flex items-center">
                                        <svg class="w-4 h-4 mr-2 text-purple-400" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M1 0l4.2 2.4v4.8L1 4.8zm6.6 3.8l4.2 2.4v4.8l-4.2-2.4zm-6.6 7l4.2 2.4v4.8L1 15.6zm6.6 3.8l4.2 2.4v4.8l-4.2-2.4zm6.6-12l4.2 2.4v4.8l-4.2-2.4zm0 10.8l4.2 2.4v4.8l-4.2-2.4z"/>
                                        </svg>
                                        Terraform Infrastructure
                                    </span>
                                    
                                    <a href="https://github.com/lazarkanelov/ls-arch-artifacts /tree/main/architectures/simple_s3_test" target="_blank" class="text-xs text-purple-400 hover:text-purple-300 flex items-center">
                                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                                        </svg>
                                        View in Artifact Repo
                                    </a>
                                    
                                </h4>
                                <div class="space-y-3">
                                    
                                    <details class="bg-slate-800 rounded-lg overflow-hidden">
                                        <summary class="px-3 py-2 bg-slate-700 text-xs text-slate-300 font-mono flex items-center cursor-pointer hover:bg-slate-600 transition">
                                            <svg class="w-4 h-4 mr-2 text-purple-400" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M1 0l4.2 2.4v4.8L1 4.8zm6.6 3.8l4.2 2.4v4.8l-4.2-2.4z"/>
                                            </svg>
                                            main.tf
                                            <svg class="ml-auto chevron w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                            </svg>
                                        </summary>
                                        <pre class="!bg-slate-900"><code class="language-hcl"># Simple S3 bucket - tflocal handles LocalStack endpoints automatically
terraform {
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 5.0"
    }
  }
}

provider "aws" {
  region = "us-east-1"
}

resource "aws_s3_bucket" "test_bucket" {
  bucket = "lsqm-test-bucket-simple"
}

output "bucket_name" {
  value = aws_s3_bucket.test_bucket.id
}
</code></pre>
                                    </details>
                                    
                                </div>
                            </div>
                            

                            <!-- Generated Test Application -->
                            
                            <div>
                                <h4 class="text-sm font-semibold text-slate-300 mb-2 flex items-center justify-between">
                                    <span class="flex items-center">
                                        <svg class="w-4 h-4 mr-2 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/>
                                        </svg>
                                        Generated Test Application
                                    </span>
                                    
                                    <a href="https://github.com/lazarkanelov/ls-arch-artifacts /tree/main/apps/simple_s3_test" target="_blank" class="text-xs text-green-400 hover:text-green-300 flex items-center">
                                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                                        </svg>
                                        View in Artifact Repo
                                    </a>
                                    
                                </h4>

                                <!-- Test Coverage Features -->
                                
                                <div class="mb-3">
                                    <span class="text-xs text-slate-500 mr-2">Test Coverage:</span>
                                    
                                    <span class="px-2 py-1 text-xs bg-purple-900/30 text-purple-300 rounded border border-purple-800/50 mr-1">
                                        AWS SDK
                                    </span>
                                    
                                    <span class="px-2 py-1 text-xs bg-purple-900/30 text-purple-300 rounded border border-purple-800/50 mr-1">
                                        Assertions
                                    </span>
                                    
                                    <span class="px-2 py-1 text-xs bg-purple-900/30 text-purple-300 rounded border border-purple-800/50 mr-1">
                                        Fixtures
                                    </span>
                                    
                                    <span class="px-2 py-1 text-xs bg-purple-900/30 text-purple-300 rounded border border-purple-800/50 mr-1">
                                        S3 Operations
                                    </span>
                                    
                                </div>
                                

                                <div class="space-y-3">
                                    
                                    <details class="bg-slate-800 rounded-lg overflow-hidden">
                                        <summary class="px-3 py-2 bg-slate-700 text-xs text-slate-300 font-mono flex items-center cursor-pointer hover:bg-slate-600 transition">
                                            <svg class="w-4 h-4 mr-2 text-green-400" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M14.25 2.26l.756-.005C17.77 2.24 18 2.308 18 3.11V4h-4V2.26zM20 8v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4a2 2 0 012-2h6.25v4H20v2z"/>
                                            </svg>
                                            test_app.py
                                            <svg class="ml-auto chevron w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                            </svg>
                                        </summary>
                                        <pre class="!bg-slate-900"><code class="language-python">"""Tests for simple S3 infrastructure."""
import pytest


def test_s3_bucket_exists(s3_client):
    """Test that at least one S3 bucket exists after terraform apply."""
    response = s3_client.list_buckets()
    buckets = response.get("Buckets", [])
    assert len(buckets) >= 1, "Expected at least one S3 bucket"
    
    # Check that our test bucket exists (starts with lsqm-test-bucket)
    bucket_names = [b["Name"] for b in buckets]
    test_buckets = [name for name in bucket_names if name.startswith("lsqm-test-bucket")]
    assert len(test_buckets) >= 1, f"Expected test bucket, found: {bucket_names}"


def test_s3_put_and_get_object(s3_client):
    """Test that we can put and get objects from the bucket."""
    response = s3_client.list_buckets()
    buckets = response.get("Buckets", [])
    
    # Find our test bucket
    bucket_names = [b["Name"] for b in buckets]
    test_bucket = next((name for name in bucket_names if name.startswith("lsqm-test-bucket")), None)
    
    if test_bucket is None:
        pytest.skip("No test bucket found")
    
    # Put an object
    test_content = "Hello from LSQM test!"
    s3_client.put_object(
        Bucket=test_bucket,
        Key="test-object.txt",
        Body=test_content.encode()
    )
    
    # Get the object back
    response = s3_client.get_object(Bucket=test_bucket, Key="test-object.txt")
    retrieved_content = response["Body"].read().decode("utf-8")
    
    assert retrieved_content == test_content


def test_s3_list_objects(s3_client):
    """Test that we can list objects in the bucket."""
    response = s3_client.list_buckets()
    buckets = response.get("Buckets", [])
    
    bucket_names = [b["Name"] for b in buckets]
    test_bucket = next((name for name in bucket_names if name.startswith("lsqm-test-bucket")), None)
    
    if test_bucket is None:
        pytest.skip("No test bucket found")
    
    # List objects
    response = s3_client.list_objects_v2(Bucket=test_bucket)
    # Should work without error
    assert response["ResponseMetadata"]["HTTPStatusCode"] == 200
</code></pre>
                                    </details>
                                    
                                    <details class="bg-slate-800 rounded-lg overflow-hidden">
                                        <summary class="px-3 py-2 bg-slate-700 text-xs text-slate-300 font-mono flex items-center cursor-pointer hover:bg-slate-600 transition">
                                            <svg class="w-4 h-4 mr-2 text-green-400" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M14.25 2.26l.756-.005C17.77 2.24 18 2.308 18 3.11V4h-4V2.26zM20 8v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4a2 2 0 012-2h6.25v4H20v2z"/>
                                            </svg>
                                            conftest.py
                                            <svg class="ml-auto chevron w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                            </svg>
                                        </summary>
                                        <pre class="!bg-slate-900"><code class="language-python">"""Pytest fixtures for S3 bucket testing."""
import os
import boto3
import pytest


@pytest.fixture(scope="session")
def localstack_endpoint():
    """Get LocalStack endpoint from environment."""
    return os.environ.get("LOCALSTACK_ENDPOINT", "http://localhost:4566")


@pytest.fixture(scope="session")
def s3_client(localstack_endpoint):
    """Create S3 client configured for LocalStack."""
    return boto3.client(
        "s3",
        endpoint_url=localstack_endpoint,
        aws_access_key_id="test",
        aws_secret_access_key="test",
        region_name="us-east-1",
    )
</code></pre>
                                    </details>
                                    
                                    <details class="bg-slate-800 rounded-lg overflow-hidden">
                                        <summary class="px-3 py-2 bg-slate-700 text-xs text-slate-300 font-mono flex items-center cursor-pointer hover:bg-slate-600 transition">
                                            <svg class="w-4 h-4 mr-2 text-green-400" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M14.25 2.26l.756-.005C17.77 2.24 18 2.308 18 3.11V4h-4V2.26zM20 8v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4a2 2 0 012-2h6.25v4H20v2z"/>
                                            </svg>
                                            app.py
                                            <svg class="ml-auto chevron w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                            </svg>
                                        </summary>
                                        <pre class="!bg-slate-900"><code class="language-python">"""Simple S3 application code."""
import os
import boto3


def get_s3_client():
    """Get S3 client configured for LocalStack."""
    endpoint = os.environ.get("LOCALSTACK_ENDPOINT", "http://localhost:4566")
    return boto3.client(
        "s3",
        endpoint_url=endpoint,
        aws_access_key_id="test",
        aws_secret_access_key="test",
        region_name="us-east-1",
    )


def list_buckets():
    """List all S3 buckets."""
    client = get_s3_client()
    response = client.list_buckets()
    return [b["Name"] for b in response.get("Buckets", [])]


def create_test_object(bucket_name, key, content):
    """Create a test object in a bucket."""
    client = get_s3_client()
    client.put_object(Bucket=bucket_name, Key=key, Body=content)


def get_test_object(bucket_name, key):
    """Get a test object from a bucket."""
    client = get_s3_client()
    response = client.get_object(Bucket=bucket_name, Key=key)
    return response["Body"].read().decode("utf-8")
</code></pre>
                                    </details>
                                    
                                    <details class="bg-slate-800 rounded-lg overflow-hidden">
                                        <summary class="px-3 py-2 bg-slate-700 text-xs text-slate-300 font-mono flex items-center cursor-pointer hover:bg-slate-600 transition">
                                            <svg class="w-4 h-4 mr-2 text-green-400" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M14.25 2.26l.756-.005C17.77 2.24 18 2.308 18 3.11V4h-4V2.26zM20 8v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4a2 2 0 012-2h6.25v4H20v2z"/>
                                            </svg>
                                            requirements.txt
                                            <svg class="ml-auto chevron w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                            </svg>
                                        </summary>
                                        <pre class="!bg-slate-900"><code class="language-python">pytest>=8.0
boto3>=1.35
</code></pre>
                                    </details>
                                    
                                </div>
                            </div>
                            

                            <!-- Use Cases Tested -->
                            
                            <div>
                                <h4 class="text-sm font-semibold text-slate-300 mb-2 flex items-center">
                                    <svg class="w-4 h-4 mr-2 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                    Use Cases Tested
                                </h4>
                                <div class="bg-slate-800 rounded-lg overflow-hidden">
                                    <div class="divide-y divide-slate-700">
                                        
                                        <div class="p-3 hover:bg-slate-700/50 transition">
                                            <div class="flex items-start">
                                                <svg class="w-5 h-5 mr-2 mt-0.5 text-green-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                                </svg>
                                                <div>
                                                    <div class="font-medium text-white text-sm">S3 Bucket Exists</div>
                                                    
                                                    <div class="text-xs text-slate-400 mt-1">Test that at least one S3 bucket exists after terraform apply.</div>
                                                    
                                                    <code class="text-xs text-slate-500 mt-1 block">test_s3_bucket_exists()</code>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="p-3 hover:bg-slate-700/50 transition">
                                            <div class="flex items-start">
                                                <svg class="w-5 h-5 mr-2 mt-0.5 text-green-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                                </svg>
                                                <div>
                                                    <div class="font-medium text-white text-sm">S3 Put And Get Object</div>
                                                    
                                                    <div class="text-xs text-slate-400 mt-1">Test that we can put and get objects from the bucket.</div>
                                                    
                                                    <code class="text-xs text-slate-500 mt-1 block">test_s3_put_and_get_object()</code>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="p-3 hover:bg-slate-700/50 transition">
                                            <div class="flex items-start">
                                                <svg class="w-5 h-5 mr-2 mt-0.5 text-green-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                                </svg>
                                                <div>
                                                    <div class="font-medium text-white text-sm">S3 List Objects</div>
                                                    
                                                    <div class="text-xs text-slate-400 mt-1">Test that we can list objects in the bucket.</div>
                                                    
                                                    <code class="text-xs text-slate-500 mt-1 block">test_s3_list_objects()</code>
                                                </div>
                                            </div>
                                        </div>
                                        
                                    </div>
                                </div>
                            </div>
                            

                            <!-- Test Results -->
                            <div>
                                <h4 class="text-sm font-semibold text-slate-300 mb-2 flex items-center">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                                    </svg>
                                    Test Results
                                </h4>
                                <div class="bg-slate-800 rounded-lg p-4">
                                    <div class="grid grid-cols-4 gap-4 mb-4 text-center">
                                        <div class="p-2 bg-slate-900 rounded">
                                            <div class="text-2xl font-bold text-white">0</div>
                                            <div class="text-xs text-slate-500">Total</div>
                                        </div>
                                        <div class="p-2 bg-green-900/30 rounded">
                                            <div class="text-2xl font-bold text-green-400">0</div>
                                            <div class="text-xs text-slate-500">Passed</div>
                                        </div>
                                        <div class="p-2 bg-red-900/30 rounded">
                                            <div class="text-2xl font-bold text-red-400">0</div>
                                            <div class="text-xs text-slate-500">Failed</div>
                                        </div>
                                        <div class="p-2 bg-slate-900 rounded">
                                            <div class="text-2xl font-bold text-slate-400">
                                                
                                                N/A
                                                
                                            </div>
                                            <div class="text-xs text-slate-500">Pass Rate</div>
                                        </div>
                                    </div>

                                    
                                </div>
                            </div>

                            <!-- Terraform Apply Output -->
                            
                            <div>
                                <h4 class="text-sm font-semibold text-slate-300 mb-2">Terraform Apply Output</h4>
                                <details class="bg-slate-800 rounded-lg overflow-hidden">
                                    <summary class="px-3 py-2 text-sm text-slate-400 cursor-pointer hover:bg-slate-700 transition">
                                        Show terraform apply logs
                                    </summary>
                                    <pre class="!bg-slate-900 text-xs overflow-auto max-h-64"><code class="language-bash">
Terraform used the selected providers to generate the following execution
plan. Resource actions are indicated with the following symbols:
  + create

Terraform will perform the following actions:

  # aws_s3_bucket.test_bucket will be created
  + resource "aws_s3_bucket" "test_bucket" {
      + acceleration_status         = (known after apply)
      + acl                         = (known after apply)
      + arn                         = (known after apply)
      + bucket                      = "lsqm-test-bucket-simple"
      + bucket_domain_name          = (known after apply)
      + bucket_prefix               = (known after apply)
      + bucket_regional_domain_name = (known after apply)
      + force_destroy               = false
      + hosted_zone_id              = (known after apply)
      + id                          = (known after apply)
      + object_lock_enabled         = (known after apply)
      + policy                      = (known after apply)
      + region                      = (known after apply)
      + request_payer               = (known after apply)
      + tags_all                    = (known after apply)
      + website_domain              = (known after apply)
      + website_endpoint            = (known after apply)
    }

Plan: 1 to add, 0 to change, 0 to destroy.

Changes to Outputs:
  + bucket_name = (known after apply)
aws_s3_bucket.test_bucket: Creating...
aws_s3_bucket.test_bucket: Creation complete after 1s [id=lsqm-test-bucket-simple]

Apply complete! Resources: 1 added, 0 changed, 0 destroyed.

Outputs:

bucket_name = "lsqm-test-bucket-simple"
</code></pre>
                                </details>
                            </div>
                            

                            <!-- Container Logs -->
                            
                        </div>
                    </details>
                </div>
                
            </div>
        </div>

        <!-- Services Tab -->
        <div id="services" class="tab-content">
            <div class="bg-slate-900 rounded-xl border border-slate-800 overflow-hidden">
                <div class="p-4 border-b border-slate-800">
                    <h2 class="text-lg font-semibold text-white">Service Compatibility Matrix</h2>
                    <p class="text-sm text-slate-400 mt-1">Pass rates per AWS service across all tested architectures</p>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-slate-800">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-slate-400 uppercase">Service</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-slate-400 uppercase">Coverage</th>
                                <th class="px-4 py-3 text-center text-xs font-medium text-slate-400 uppercase">Passed</th>
                                <th class="px-4 py-3 text-center text-xs font-medium text-slate-400 uppercase">Failed</th>
                                <th class="px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase">Pass Rate</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-800">
                            
                            <tr class="hover:bg-slate-800/50 transition">
                                <td class="px-4 py-3">
                                    <span class="font-medium text-white">s3</span>
                                </td>
                                <td class="px-4 py-3">
                                    <div class="w-full bg-slate-700 rounded-full h-2">
                                        <div class="h-2 rounded-full transition-all duration-500
                                            bg-green-500"
                                             style="width: 100.0%"></div>
                                    </div>
                                </td>
                                <td class="px-4 py-3 text-center text-green-400">1</td>
                                <td class="px-4 py-3 text-center text-red-400">0</td>
                                <td class="px-4 py-3 text-right">
                                    <span class="font-semibold text-green-400">
                                        100%
                                    </span>
                                </td>
                            </tr>
                            
                            <tr class="hover:bg-slate-800/50 transition">
                                <td class="px-4 py-3">
                                    <span class="font-medium text-white">ec2</span>
                                </td>
                                <td class="px-4 py-3">
                                    <div class="w-full bg-slate-700 rounded-full h-2">
                                        <div class="h-2 rounded-full transition-all duration-500
                                            bg-red-500"
                                             style="width: 0.0%"></div>
                                    </div>
                                </td>
                                <td class="px-4 py-3 text-center text-green-400">0</td>
                                <td class="px-4 py-3 text-center text-red-400">1</td>
                                <td class="px-4 py-3 text-right">
                                    <span class="font-semibold text-red-400">
                                        0%
                                    </span>
                                </td>
                            </tr>
                            
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- History Tab -->
        <div id="history" class="tab-content">
            <div class="bg-slate-900 rounded-xl border border-slate-800 overflow-hidden">
                <div class="p-4 border-b border-slate-800">
                    <h2 class="text-lg font-semibold text-white">Run History</h2>
                    <p class="text-sm text-slate-400 mt-1">Previous validation runs</p>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-slate-800">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-slate-400 uppercase">Run ID</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-slate-400 uppercase">Date</th>
                                <th class="px-4 py-3 text-center text-xs font-medium text-slate-400 uppercase">Total</th>
                                <th class="px-4 py-3 text-center text-xs font-medium text-slate-400 uppercase">Passed</th>
                                <th class="px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase">Pass Rate</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-800">
                            
                            <tr class="hover:bg-slate-800/50 transition bg-blue-900/20">
                                <td class="px-4 py-3">
                                    <code class="text-sm text-slate-300">30382831</code>
                                    <span class="ml-2 text-xs text-blue-400">(current)</span>
                                </td>
                                <td class="px-4 py-3 text-slate-300">2026-01-10</td>
                                <td class="px-4 py-3 text-center text-white">2</td>
                                <td class="px-4 py-3 text-center text-green-400">-</td>
                                <td class="px-4 py-3 text-right">
                                    <span class="font-semibold text-yellow-400">
                                        50%
                                    </span>
                                </td>
                            </tr>
                            
                            <tr class="hover:bg-slate-800/50 transition ">
                                <td class="px-4 py-3">
                                    <code class="text-sm text-slate-300">4d63a16c</code>
                                    
                                </td>
                                <td class="px-4 py-3 text-slate-300">2026-01-11</td>
                                <td class="px-4 py-3 text-center text-white">2</td>
                                <td class="px-4 py-3 text-center text-green-400">-</td>
                                <td class="px-4 py-3 text-right">
                                    <span class="font-semibold text-yellow-400">
                                        50%
                                    </span>
                                </td>
                            </tr>
                            
                            <tr class="hover:bg-slate-800/50 transition ">
                                <td class="px-4 py-3">
                                    <code class="text-sm text-slate-300">cdcdbff8</code>
                                    
                                </td>
                                <td class="px-4 py-3 text-slate-300">2026-01-10</td>
                                <td class="px-4 py-3 text-center text-white">1</td>
                                <td class="px-4 py-3 text-center text-green-400">-</td>
                                <td class="px-4 py-3 text-right">
                                    <span class="font-semibold text-green-400">
                                        100%
                                    </span>
                                </td>
                            </tr>
                            
                            <tr class="hover:bg-slate-800/50 transition ">
                                <td class="px-4 py-3">
                                    <code class="text-sm text-slate-300">ed725da5</code>
                                    
                                </td>
                                <td class="px-4 py-3 text-slate-300">2026-01-10</td>
                                <td class="px-4 py-3 text-center text-white">2</td>
                                <td class="px-4 py-3 text-center text-green-400">-</td>
                                <td class="px-4 py-3 text-right">
                                    <span class="font-semibold text-yellow-400">
                                        50%
                                    </span>
                                </td>
                            </tr>
                            
                            <tr class="hover:bg-slate-800/50 transition ">
                                <td class="px-4 py-3">
                                    <code class="text-sm text-slate-300">b5aa050f</code>
                                    
                                </td>
                                <td class="px-4 py-3 text-slate-300">2026-01-10</td>
                                <td class="px-4 py-3 text-center text-white">1</td>
                                <td class="px-4 py-3 text-center text-green-400">-</td>
                                <td class="px-4 py-3 text-right">
                                    <span class="font-semibold text-green-400">
                                        100%
                                    </span>
                                </td>
                            </tr>
                            
                            <tr class="hover:bg-slate-800/50 transition ">
                                <td class="px-4 py-3">
                                    <code class="text-sm text-slate-300">e6686639</code>
                                    
                                </td>
                                <td class="px-4 py-3 text-slate-300">2026-01-11</td>
                                <td class="px-4 py-3 text-center text-white">2</td>
                                <td class="px-4 py-3 text-center text-green-400">-</td>
                                <td class="px-4 py-3 text-right">
                                    <span class="font-semibold text-yellow-400">
                                        50%
                                    </span>
                                </td>
                            </tr>
                            
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="border-t border-slate-800 mt-12">
        <div class="container mx-auto px-4 py-6 text-center text-slate-500 text-sm">
            <p>Generated by LocalStack Quality Monitor &bull; 2026-01-11</p>
            <p class="mt-1">
                <a href="https://localstack.cloud" target="_blank" class="text-blue-400 hover:text-blue-300">LocalStack</a>
                &bull;
                <a href="https://github.com/localstack/localstack" target="_blank" class="text-blue-400 hover:text-blue-300">GitHub</a>
            </p>
        </div>
    </footer>

    <script>
        // Tab switching
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => {
                el.classList.remove('active');
                el.classList.add('text-slate-400');
            });

            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
            event.target.classList.remove('text-slate-400');
        }

        // Result filtering
        function filterResults(status) {
            document.querySelectorAll('.result-card').forEach(card => {
                if (status === 'all' || card.dataset.status === status) {
                    card.style.display = 'block';
                } else if (status === 'failed' && ['failed', 'timeout', 'error'].includes(card.dataset.status)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });

            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        // Trend chart
        const ctx = document.getElementById('trendChart');
        if (ctx) {
            new Chart(ctx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: ["2026-01-10", "2026-01-11", "2026-01-10", "2026-01-10", "2026-01-10", "2026-01-11"],
                    datasets: [{
                        label: 'Pass Rate %',
                        data: [50.0, 50.0, 100.0, 50.0, 100.0, 50.0],
                        borderColor: 'rgb(34, 197, 94)',
                        backgroundColor: 'rgba(34, 197, 94, 0.1)',
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            grid: { color: 'rgba(71, 85, 105, 0.3)' },
                            ticks: { color: '#94a3b8' }
                        },
                        x: {
                            grid: { color: 'rgba(71, 85, 105, 0.3)' },
                            ticks: { color: '#94a3b8' }
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }

        // Syntax highlighting on expand
        document.querySelectorAll('details').forEach(details => {
            details.addEventListener('toggle', () => {
                if (details.open) {
                    Prism.highlightAllUnder(details);
                }
            });
        });
    </script>
</body>
</html>